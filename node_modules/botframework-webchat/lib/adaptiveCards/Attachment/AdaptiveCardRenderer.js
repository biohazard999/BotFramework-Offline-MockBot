"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _adaptivecards = require("adaptivecards");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatComponent = require("botframework-webchat-component");

/* eslint no-magic-numbers: ["error", { "ignore": [0, 2] }] */
var ErrorBox = _botframeworkWebchatComponent.Components.ErrorBox;

function isPlainObject(obj) {
  return Object.getPrototypeOf(obj) === Object.prototype;
}

var AdaptiveCardRenderer =
/*#__PURE__*/
function (_React$PureComponent) {
  (0, _inherits2.default)(AdaptiveCardRenderer, _React$PureComponent);

  function AdaptiveCardRenderer(props) {
    var _this;

    (0, _classCallCheck2.default)(this, AdaptiveCardRenderer);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(AdaptiveCardRenderer).call(this, props));
    _this.handleClick = _this.handleClick.bind((0, _assertThisInitialized2.default)(_this));
    _this.handleExecuteAction = _this.handleExecuteAction.bind((0, _assertThisInitialized2.default)(_this));
    _this.contentRef = _react.default.createRef();
    _this.state = {
      error: null
    };
    return _this;
  }

  (0, _createClass2.default)(AdaptiveCardRenderer, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.renderCard();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(_ref) {
      var prevAdaptiveCard = _ref.adaptiveCard;
      var adaptiveCard = this.props.adaptiveCard;
      prevAdaptiveCard !== adaptiveCard && this.renderCard();
    }
  }, {
    key: "handleClick",
    value: function handleClick(_ref2) {
      var target = _ref2.target;
      var _this$props = this.props,
          disabled = _this$props.disabled,
          onCardAction = _this$props.onCardAction,
          tapAction = _this$props.tapAction; // Some items, e.g. tappable text, cannot be disabled thru DOM attributes

      if (!disabled) {
        var tabIndex = (0, _botframeworkWebchatComponent.getTabIndex)(target); // If the user is clicking on something that is already clickable, do not allow them to click the card.
        // E.g. a hero card can be tappable, and image and buttons inside the hero card can also be tappable.

        if (typeof tabIndex !== 'number' || tabIndex < 0) {
          tapAction && onCardAction(tapAction);
        }
      }
    }
  }, {
    key: "handleExecuteAction",
    value: function handleExecuteAction(action) {
      var _this$props2 = this.props,
          disabled = _this$props2.disabled,
          onCardAction = _this$props2.onCardAction; // Some items, e.g. tappable image, cannot be disabled thru DOM attributes

      if (disabled) {
        return;
      }

      var actionTypeName = action.getJsonTypeName();

      if (actionTypeName === 'Action.OpenUrl') {
        onCardAction({
          type: 'openUrl',
          value: action.url
        });
      } else if (actionTypeName === 'Action.Submit') {
        if (typeof action.data !== 'undefined') {
          var actionData = action.data;

          if (actionData && actionData.__isBotFrameworkCardAction) {
            var cardAction = actionData.cardAction;
            var displayText = cardAction.displayText,
                type = cardAction.type,
                value = cardAction.value;
            onCardAction({
              displayText: displayText,
              type: type,
              value: value
            });
          } else {
            onCardAction({
              type: typeof action.data === 'string' ? 'imBack' : 'postBack',
              value: action.data
            });
          }
        }
      } else {
        console.error("Web Chat: received unknown action from Adaptive Cards");
        console.error(action);
      }
    }
  }, {
    key: "renderCard",
    value: function renderCard() {
      var current = this.contentRef.current,
          _this$props3 = this.props,
          adaptiveCard = _this$props3.adaptiveCard,
          adaptiveCardHostConfig = _this$props3.adaptiveCardHostConfig,
          disabled = _this$props3.disabled,
          renderMarkdown = _this$props3.renderMarkdown,
          error = this.state.error;

      if (current && adaptiveCard) {
        // Currently, the only way to set the Markdown engine is to set it thru static member of AdaptiveCard class
        // TODO: [P3] Checks if we could make the "renderMarkdown" per card
        //       This could be limitations from Adaptive Cards package
        //       Because there could be timing difference between .parse and .render, we could be using wrong Markdown engine
        adaptiveCard.constructor.onProcessMarkdown = function (text, result) {
          if (renderMarkdown) {
            result.outputHtml = renderMarkdown(text);
            result.didProcess = true;
          }
        };

        adaptiveCard.onExecuteAction = this.handleExecuteAction;

        if (adaptiveCardHostConfig) {
          adaptiveCard.hostConfig = isPlainObject(adaptiveCardHostConfig) ? new _adaptivecards.HostConfig(adaptiveCardHostConfig) : adaptiveCardHostConfig;
        }

        var _adaptiveCard$validat = adaptiveCard.validateProperties(),
            failures = _adaptiveCard$validat.failures;

        if (failures.length) {
          // TODO: [P3] Since this can be called from `componentDidUpdate` and potentially error, we should fix a better way to propagate the error.
          var errors = failures.map(function (_ref3) {
            var errors = _ref3.errors;
            return errors;
          }).flat();
          return this.setState(function () {
            return {
              error: errors
            };
          });
        }

        var element;

        try {
          element = adaptiveCard.render();
        } catch (error) {
          return this.setState(function () {
            return {
              error: error
            };
          });
        }

        if (!element) {
          return this.setState(function () {
            return {
              error: 'Adaptive Card rendered as empty element'
            };
          });
        }

        error && this.setState(function () {
          return {
            error: null
          };
        });

        if (disabled) {
          var hyperlinks = element.querySelectorAll('a');
          var inputs = element.querySelectorAll('button, input, select, textarea');
          [].forEach.call(inputs, function (input) {
            input.disabled = true;
          });
          [].forEach.call(hyperlinks, function (hyperlink) {
            hyperlink.addEventListener('click', function (event) {
              event.preventDefault();
              event.stopImmediatePropagation();
              event.stopPropagation();
            });
          });
        }

        var _current$children = (0, _slicedToArray2.default)(current.children, 1),
            firstChild = _current$children[0];

        if (firstChild) {
          current.replaceChild(element, firstChild);
        } else {
          current.appendChild(element);
        }
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props4 = this.props,
          language = _this$props4.language,
          styleSet = _this$props4.styleSet,
          error = this.state.error;
      return error ? _react.default.createElement(ErrorBox, {
        message: (0, _botframeworkWebchatComponent.localize)('Adaptive Card render error', language)
      }, _react.default.createElement("pre", null, JSON.stringify(error, null, 2))) : _react.default.createElement("div", {
        className: styleSet.adaptiveCardRenderer,
        onClick: this.handleClick,
        ref: this.contentRef
      });
    }
  }]);
  return AdaptiveCardRenderer;
}(_react.default.PureComponent);

AdaptiveCardRenderer.propTypes = {
  adaptiveCard: _propTypes.default.any.isRequired,
  adaptiveCardHostConfig: _propTypes.default.any.isRequired,
  disabled: _propTypes.default.bool,
  language: _propTypes.default.string.isRequired,
  onCardAction: _propTypes.default.func.isRequired,
  renderMarkdown: _propTypes.default.func.isRequired,
  styleSet: _propTypes.default.shape({
    adaptiveCardRenderer: _propTypes.default.any.isRequired
  }).isRequired,
  tapAction: _propTypes.default.func
};
AdaptiveCardRenderer.defaultProps = {
  disabled: false,
  tapAction: undefined
};

var _default = (0, _botframeworkWebchatComponent.connectToWebChat)(function (_ref4) {
  var disabled = _ref4.disabled,
      language = _ref4.language,
      onCardAction = _ref4.onCardAction,
      renderMarkdown = _ref4.renderMarkdown,
      styleSet = _ref4.styleSet,
      tapAction = _ref4.tapAction;
  return {
    disabled: disabled,
    language: language,
    onCardAction: onCardAction,
    renderMarkdown: renderMarkdown,
    styleSet: styleSet,
    tapAction: tapAction
  };
})(AdaptiveCardRenderer);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvQWRhcHRpdmVDYXJkUmVuZGVyZXIuanMiXSwibmFtZXMiOlsiRXJyb3JCb3giLCJDb21wb25lbnRzIiwiaXNQbGFpbk9iamVjdCIsIm9iaiIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwiQWRhcHRpdmVDYXJkUmVuZGVyZXIiLCJwcm9wcyIsImhhbmRsZUNsaWNrIiwiYmluZCIsImhhbmRsZUV4ZWN1dGVBY3Rpb24iLCJjb250ZW50UmVmIiwiUmVhY3QiLCJjcmVhdGVSZWYiLCJzdGF0ZSIsImVycm9yIiwicmVuZGVyQ2FyZCIsInByZXZBZGFwdGl2ZUNhcmQiLCJhZGFwdGl2ZUNhcmQiLCJ0YXJnZXQiLCJkaXNhYmxlZCIsIm9uQ2FyZEFjdGlvbiIsInRhcEFjdGlvbiIsInRhYkluZGV4IiwiYWN0aW9uIiwiYWN0aW9uVHlwZU5hbWUiLCJnZXRKc29uVHlwZU5hbWUiLCJ0eXBlIiwidmFsdWUiLCJ1cmwiLCJkYXRhIiwiYWN0aW9uRGF0YSIsIl9faXNCb3RGcmFtZXdvcmtDYXJkQWN0aW9uIiwiY2FyZEFjdGlvbiIsImRpc3BsYXlUZXh0IiwiY29uc29sZSIsImN1cnJlbnQiLCJhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnIiwicmVuZGVyTWFya2Rvd24iLCJjb25zdHJ1Y3RvciIsIm9uUHJvY2Vzc01hcmtkb3duIiwidGV4dCIsInJlc3VsdCIsIm91dHB1dEh0bWwiLCJkaWRQcm9jZXNzIiwib25FeGVjdXRlQWN0aW9uIiwiaG9zdENvbmZpZyIsIkhvc3RDb25maWciLCJ2YWxpZGF0ZVByb3BlcnRpZXMiLCJmYWlsdXJlcyIsImxlbmd0aCIsImVycm9ycyIsIm1hcCIsImZsYXQiLCJzZXRTdGF0ZSIsImVsZW1lbnQiLCJyZW5kZXIiLCJoeXBlcmxpbmtzIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0cyIsImZvckVhY2giLCJjYWxsIiwiaW5wdXQiLCJoeXBlcmxpbmsiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiIsInN0b3BQcm9wYWdhdGlvbiIsImNoaWxkcmVuIiwiZmlyc3RDaGlsZCIsInJlcGxhY2VDaGlsZCIsImFwcGVuZENoaWxkIiwibGFuZ3VhZ2UiLCJzdHlsZVNldCIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGFwdGl2ZUNhcmRSZW5kZXJlciIsIlB1cmVDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJhbnkiLCJpc1JlcXVpcmVkIiwiYm9vbCIsInN0cmluZyIsImZ1bmMiLCJzaGFwZSIsImRlZmF1bHRQcm9wcyIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFOQTtJQVFRQSxRLEdBQWFDLHdDLENBQWJELFE7O0FBRVIsU0FBU0UsYUFBVCxDQUF1QkMsR0FBdkIsRUFBNEI7QUFDMUIsU0FBT0MsTUFBTSxDQUFDQyxjQUFQLENBQXNCRixHQUF0QixNQUErQkMsTUFBTSxDQUFDRSxTQUE3QztBQUNEOztJQUVLQyxvQjs7Ozs7QUFDSixnQ0FBWUMsS0FBWixFQUFtQjtBQUFBOztBQUFBO0FBQ2pCLDBIQUFNQSxLQUFOO0FBRUEsVUFBS0MsV0FBTCxHQUFtQixNQUFLQSxXQUFMLENBQWlCQyxJQUFqQiw2Q0FBbkI7QUFDQSxVQUFLQyxtQkFBTCxHQUEyQixNQUFLQSxtQkFBTCxDQUF5QkQsSUFBekIsNkNBQTNCO0FBRUEsVUFBS0UsVUFBTCxHQUFrQkMsZUFBTUMsU0FBTixFQUFsQjtBQUVBLFVBQUtDLEtBQUwsR0FBYTtBQUNYQyxNQUFBQSxLQUFLLEVBQUU7QUFESSxLQUFiO0FBUmlCO0FBV2xCOzs7O3dDQUVtQjtBQUNsQixXQUFLQyxVQUFMO0FBQ0Q7Ozs2Q0FFc0Q7QUFBQSxVQUFwQkMsZ0JBQW9CLFFBQWxDQyxZQUFrQztBQUFBLFVBQzdDQSxZQUQ2QyxHQUM1QixL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QkFBb0IsRUFBRUcsbUJBQVVDLEdBQVYsQ0FBY0M7QUFEWixHQUFoQixFQUVQQSxVQVQ0QjtBQVUvQjVELEVBQUFBLFNBQVMsRUFBRTBELG1CQUFVSztBQVZVLENBQWpDO0FBYUEvRSxvQkFBb0IsQ0FBQ2lGLFlBQXJCLEdBQW9DO0FBQ2xDbkUsRUFBQUEsUUFBUSxFQUFFLEtBRHdCO0FBRWxDRSxFQUFBQSxTQUFTLEVBQUVrRTtBQUZ1QixDQUFwQzs7ZUFLZSxvREFBaUI7QUFBQSxNQUFHcEUsUUFBSCxTQUFHQSxRQUFIO0FBQUEsTUFBYXFELFFBQWIsU0FBYUEsUUFBYjtBQUFBLE1BQXVCcEQsWUFBdkIsU0FBdUJBLFlBQXZCO0FBQUEsTUFBcUNpQixjQUFyQyxTQUFxQ0EsY0FBckM7QUFBQSxNQUFxRG9DLFFBQXJELFNBQXFEQSxRQUFyRDtBQUFBLE1BQStEcEQsU0FBL0QsU0FBK0RBLFNBQS9EO0FBQUEsU0FBZ0Y7QUFDOUdGLElBQUFBLFFBQVEsRUFBUkEsUUFEOEc7QUFFOUdxRCxJQUFBQSxRQUFRLEVBQVJBLFFBRjhHO0FBRzlHcEQsSUFBQUEsWUFBWSxFQUFaQSxZQUg4RztBQUk5R2lCLElBQUFBLGNBQWMsRUFBZEEsY0FKOEc7QUFLOUdvQyxJQUFBQSxRQUFRLEVBQVJBLFFBTDhHO0FBTTlHcEQsSUFBQUEsU0FBUyxFQUFUQTtBQU44RyxHQUFoRjtBQUFBLENBQWpCLEVBT1hoQixvQkFQVyxDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50IG5vLW1hZ2ljLW51bWJlcnM6IFtcImVycm9yXCIsIHsgXCJpZ25vcmVcIjogWzAsIDJdIH1dICovXG5cbmltcG9ydCB7IEhvc3RDb25maWcgfSBmcm9tICdhZGFwdGl2ZWNhcmRzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBDb21wb25lbnRzLCBjb25uZWN0VG9XZWJDaGF0LCBnZXRUYWJJbmRleCwgbG9jYWxpemUgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb21wb25lbnQnO1xuXG5jb25zdCB7IEVycm9yQm94IH0gPSBDb21wb25lbnRzO1xuXG5mdW5jdGlvbiBpc1BsYWluT2JqZWN0KG9iaikge1xuICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikgPT09IE9iamVjdC5wcm90b3R5cGU7XG59XG5cbmNsYXNzIEFkYXB0aXZlQ2FyZFJlbmRlcmVyIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5oYW5kbGVDbGljayA9IHRoaXMuaGFuZGxlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUV4ZWN1dGVBY3Rpb24gPSB0aGlzLmhhbmRsZUV4ZWN1dGVBY3Rpb24uYmluZCh0aGlzKTtcblxuICAgIHRoaXMuY29udGVudFJlZiA9IFJlYWN0LmNyZWF0ZVJlZigpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGVycm9yOiBudWxsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMucmVuZGVyQ2FyZCgpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHsgYWRhcHRpdmVDYXJkOiBwcmV2QWRhcHRpdmVDYXJkIH0pIHtcbiAgICBjb25zdCB7IGFkYXB0aXZlQ2FyZCB9ID0gdGhpcy5wcm9wcztcblxuICAgIHByZXZBZGFwdGl2ZUNhcmQgIT09IGFkYXB0aXZlQ2FyZCAmJiB0aGlzLnJlbmRlckNhcmQoKTtcbiAgfVxuXG4gIGhhbmRsZUNsaWNrKHsgdGFyZ2V0IH0pIHtcbiAgICBjb25zdCB7IGRpc2FibGVkLCBvbkNhcmRBY3Rpb24sIHRhcEFjdGlvbiB9ID0gdGhpcy5wcm9wcztcblxuICAgIC8vIFNvbWUgaXRlbXMsIGUuZy4gdGFwcGFibGUgdGV4dCwgY2Fubm90IGJlIGRpc2FibGVkIHRocnUgRE9NIGF0dHJpYnV0ZXNcbiAgICBpZiAoIWRpc2FibGVkKSB7XG4gICAgICBjb25zdCB0YWJJbmRleCA9IGdldFRhYkluZGV4KHRhcmdldCk7XG5cbiAgICAgIC8vIElmIHRoZSB1c2VyIGlzIGNsaWNraW5nIG9uIHNvbWV0aGluZyB0aGF0IGlzIGFscmVhZHkgY2xpY2thYmxlLCBkbyBub3QgYWxsb3cgdGhlbSB0byBjbGljayB0aGUgY2FyZC5cbiAgICAgIC8vIEUuZy4gYSBoZXJvIGNhcmQgY2FuIGJlIHRhcHBhYmxlLCBhbmQgaW1hZ2UgYW5kIGJ1dHRvbnMgaW5zaWRlIHRoZSBoZXJvIGNhcmQgY2FuIGFsc28gYmUgdGFwcGFibGUuXG4gICAgICBpZiAodHlwZW9mIHRhYkluZGV4ICE9PSAnbnVtYmVyJyB8fCB0YWJJbmRleCA8IDApIHtcbiAgICAgICAgdGFwQWN0aW9uICYmIG9uQ2FyZEFjdGlvbih0YXBBY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUV4ZWN1dGVBY3Rpb24oYWN0aW9uKSB7XG4gICAgY29uc3QgeyBkaXNhYmxlZCwgb25DYXJkQWN0aW9uIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgLy8gU29tZSBpdGVtcywgZS5nLiB0YXBwYWJsZSBpbWFnZSwgY2Fubm90IGJlIGRpc2FibGVkIHRocnUgRE9NIGF0dHJpYnV0ZXNcbiAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBhY3Rpb25UeXBlTmFtZSA9IGFjdGlvbi5nZXRKc29uVHlwZU5hbWUoKTtcblxuICAgIGlmIChhY3Rpb25UeXBlTmFtZSA9PT0gJ0FjdGlvbi5PcGVuVXJsJykge1xuICAgICAgb25DYXJkQWN0aW9uKHtcbiAgICAgICAgdHlwZTogJ29wZW5VcmwnLFxuICAgICAgICB2YWx1ZTogYWN0aW9uLnVybFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb25UeXBlTmFtZSA9PT0gJ0FjdGlvbi5TdWJtaXQnKSB7XG4gICAgICBpZiAodHlwZW9mIGFjdGlvbi5kYXRhICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBjb25zdCB7IGRhdGE6IGFjdGlvbkRhdGEgfSA9IGFjdGlvbjtcblxuICAgICAgICBpZiAoYWN0aW9uRGF0YSAmJiBhY3Rpb25EYXRhLl9faXNCb3RGcmFtZXdvcmtDYXJkQWN0aW9uKSB7XG4gICAgICAgICAgY29uc3QgeyBjYXJkQWN0aW9uIH0gPSBhY3Rpb25EYXRhO1xuICAgICAgICAgIGNvbnN0IHsgZGlzcGxheVRleHQsIHR5cGUsIHZhbHVlIH0gPSBjYXJkQWN0aW9uO1xuXG4gICAgICAgICAgb25DYXJkQWN0aW9uKHsgZGlzcGxheVRleHQsIHR5cGUsIHZhbHVlIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9uQ2FyZEFjdGlvbih7XG4gICAgICAgICAgICB0eXBlOiB0eXBlb2YgYWN0aW9uLmRhdGEgPT09ICdzdHJpbmcnID8gJ2ltQmFjaycgOiAncG9zdEJhY2snLFxuICAgICAgICAgICAgdmFsdWU6IGFjdGlvbi5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcihgV2ViIENoYXQ6IHJlY2VpdmVkIHVua25vd24gYWN0aW9uIGZyb20gQWRhcHRpdmUgQ2FyZHNgKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXJDYXJkKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNvbnRlbnRSZWY6IHsgY3VycmVudCB9LFxuICAgICAgcHJvcHM6IHsgYWRhcHRpdmVDYXJkLCBhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnLCBkaXNhYmxlZCwgcmVuZGVyTWFya2Rvd24gfSxcbiAgICAgIHN0YXRlOiB7IGVycm9yIH1cbiAgICB9ID0gdGhpcztcblxuICAgIGlmIChjdXJyZW50ICYmIGFkYXB0aXZlQ2FyZCkge1xuICAgICAgLy8gQ3VycmVudGx5LCB0aGUgb25seSB3YXkgdG8gc2V0IHRoZSBNYXJrZG93biBlbmdpbmUgaXMgdG8gc2V0IGl0IHRocnUgc3RhdGljIG1lbWJlciBvZiBBZGFwdGl2ZUNhcmQgY2xhc3NcblxuICAgICAgLy8gVE9ETzogW1AzXSBDaGVja3MgaWYgd2UgY291bGQgbWFrZSB0aGUgXCJyZW5kZXJNYXJrZG93blwiIHBlciBjYXJkXG4gICAgICAvLyAgICAgICBUaGlzIGNvdWxkIGJlIGxpbWl0YXRpb25zIGZyb20gQWRhcHRpdmUgQ2FyZHMgcGFja2FnZVxuICAgICAgLy8gICAgICAgQmVjYXVzZSB0aGVyZSBjb3VsZCBiZSB0aW1pbmcgZGlmZmVyZW5jZSBiZXR3ZWVuIC5wYXJzZSBhbmQgLnJlbmRlciwgd2UgY291bGQgYmUgdXNpbmcgd3JvbmcgTWFya2Rvd24gZW5naW5lXG5cbiAgICAgIGFkYXB0aXZlQ2FyZC5jb25zdHJ1Y3Rvci5vblByb2Nlc3NNYXJrZG93biA9ICh0ZXh0LCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKHJlbmRlck1hcmtkb3duKSB7XG4gICAgICAgICAgcmVzdWx0Lm91dHB1dEh0bWwgPSByZW5kZXJNYXJrZG93bih0ZXh0KTtcbiAgICAgICAgICByZXN1bHQuZGlkUHJvY2VzcyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGFkYXB0aXZlQ2FyZC5vbkV4ZWN1dGVBY3Rpb24gPSB0aGlzLmhhbmRsZUV4ZWN1dGVBY3Rpb247XG5cbiAgICAgIGlmIChhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnKSB7XG4gICAgICAgIGFkYXB0aXZlQ2FyZC5ob3N0Q29uZmlnID0gaXNQbGFpbk9iamVjdChhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnKVxuICAgICAgICAgID8gbmV3IEhvc3RDb25maWcoYWRhcHRpdmVDYXJkSG9zdENvbmZpZylcbiAgICAgICAgICA6IGFkYXB0aXZlQ2FyZEhvc3RDb25maWc7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZmFpbHVyZXMgfSA9IGFkYXB0aXZlQ2FyZC52YWxpZGF0ZVByb3BlcnRpZXMoKTtcblxuICAgICAgaWYgKGZhaWx1cmVzLmxlbmd0aCkge1xuICAgICAgICAvLyBUT0RPOiBbUDNdIFNpbmNlIHRoaXMgY2FuIGJlIGNhbGxlZCBmcm9tIGBjb21wb25lbnREaWRVcGRhdGVgIGFuZCBwb3RlbnRpYWxseSBlcnJvciwgd2Ugc2hvdWxkIGZpeCBhIGJldHRlciB3YXkgdG8gcHJvcGFnYXRlIHRoZSBlcnJvci5cbiAgICAgICAgY29uc3QgZXJyb3JzID0gZmFpbHVyZXMubWFwKCh7IGVycm9ycyB9KSA9PiBlcnJvcnMpLmZsYXQoKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSgoKSA9PiAoeyBlcnJvcjogZXJyb3JzIH0pKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGVsZW1lbnQ7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGVsZW1lbnQgPSBhZGFwdGl2ZUNhcmQucmVuZGVyKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSgoKSA9PiAoeyBlcnJvciB9KSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSgoKSA9PiAoeyBlcnJvcjogJ0FkYXB0aXZlIENhcmQgcmVuZGVyZWQgYXMgZW1wdHkgZWxlbWVudCcgfSkpO1xuICAgICAgfVxuXG4gICAgICBlcnJvciAmJiB0aGlzLnNldFN0YXRlKCgpID0+ICh7IGVycm9yOiBudWxsIH0pKTtcblxuICAgICAgaWYgKGRpc2FibGVkKSB7XG4gICAgICAgIGNvbnN0IGh5cGVybGlua3MgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKTtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24sIGlucHV0LCBzZWxlY3QsIHRleHRhcmVhJyk7XG5cbiAgICAgICAgW10uZm9yRWFjaC5jYWxsKGlucHV0cywgaW5wdXQgPT4ge1xuICAgICAgICAgIGlucHV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgW10uZm9yRWFjaC5jYWxsKGh5cGVybGlua3MsIGh5cGVybGluayA9PiB7XG4gICAgICAgICAgaHlwZXJsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbZmlyc3RDaGlsZF0gPSBjdXJyZW50LmNoaWxkcmVuO1xuXG4gICAgICBpZiAoZmlyc3RDaGlsZCkge1xuICAgICAgICBjdXJyZW50LnJlcGxhY2VDaGlsZChlbGVtZW50LCBmaXJzdENoaWxkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHByb3BzOiB7IGxhbmd1YWdlLCBzdHlsZVNldCB9LFxuICAgICAgc3RhdGU6IHsgZXJyb3IgfVxuICAgIH0gPSB0aGlzO1xuXG4gICAgcmV0dXJuIGVycm9yID8gKFxuICAgICAgPEVycm9yQm94IG1lc3NhZ2U9e2xvY2FsaXplKCdBZGFwdGl2ZSBDYXJkIHJlbmRlciBlcnJvcicsIGxhbmd1YWdlKX0+XG4gICAgICAgIDxwcmU+e0pTT04uc3RyaW5naWZ5KGVycm9yLCBudWxsLCAyKX08L3ByZT5cbiAgICAgIDwvRXJyb3JCb3g+XG4gICAgKSA6IChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZVNldC5hZGFwdGl2ZUNhcmRSZW5kZXJlcn0gb25DbGljaz17dGhpcy5oYW5kbGVDbGlja30gcmVmPXt0aGlzLmNvbnRlbnRSZWZ9IC8+XG4gICAgKTtcbiAgfVxufVxuXG5BZGFwdGl2ZUNhcmRSZW5kZXJlci5wcm9wVHlwZXMgPSB7XG4gIGFkYXB0aXZlQ2FyZDogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkLFxuICBhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnOiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWQsXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgbGFuZ3VhZ2U6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgb25DYXJkQWN0aW9uOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICByZW5kZXJNYXJrZG93bjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgc3R5bGVTZXQ6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgYWRhcHRpdmVDYXJkUmVuZGVyZXI6IFByb3BUeXBlcy5hbnkuaXNSZXF1aXJlZFxuICB9KS5pc1JlcXVpcmVkLFxuICB0YXBBY3Rpb246IFByb3BUeXBlcy5mdW5jXG59O1xuXG5BZGFwdGl2ZUNhcmRSZW5kZXJlci5kZWZhdWx0UHJvcHMgPSB7XG4gIGRpc2FibGVkOiBmYWxzZSxcbiAgdGFwQWN0aW9uOiB1bmRlZmluZWRcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb1dlYkNoYXQoKHsgZGlzYWJsZWQsIGxhbmd1YWdlLCBvbkNhcmRBY3Rpb24sIHJlbmRlck1hcmtkb3duLCBzdHlsZVNldCwgdGFwQWN0aW9uIH0pID0+ICh7XG4gIGRpc2FibGVkLFxuICBsYW5ndWFnZSxcbiAgb25DYXJkQWN0aW9uLFxuICByZW5kZXJNYXJrZG93bixcbiAgc3R5bGVTZXQsXG4gIHRhcEFjdGlvblxufSkpKEFkYXB0aXZlQ2FyZFJlbmRlcmVyKTtcbiJdfQ==