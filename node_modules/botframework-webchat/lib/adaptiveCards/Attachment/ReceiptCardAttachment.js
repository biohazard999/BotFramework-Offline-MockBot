"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _toArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _botframeworkWebchatComponent = require("botframework-webchat-component");

var _memoizeOne = _interopRequireDefault(require("memoize-one"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _AdaptiveCardBuilder = _interopRequireDefault(require("./AdaptiveCardBuilder"));

var _AdaptiveCardRenderer = _interopRequireDefault(require("./AdaptiveCardRenderer"));

/* eslint no-magic-numbers: ["error", { "ignore": [0, 1, 10, 15, 25, 75] }] */
function nullOrUndefined(obj) {
  return obj === null || typeof obj === 'undefined';
}

var ReceiptCardAttachment =
/*#__PURE__*/
function (_React$Component) {
  (0, _inherits2.default)(ReceiptCardAttachment, _React$Component);

  function ReceiptCardAttachment(props) {
    var _this;

    (0, _classCallCheck2.default)(this, ReceiptCardAttachment);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(ReceiptCardAttachment).call(this, props));
    _this.buildCard = (0, _memoizeOne.default)(function (adaptiveCards, _ref, language, styleOptions) {
      var buttons = _ref.buttons,
          facts = _ref.facts,
          items = _ref.items,
          tax = _ref.tax,
          title = _ref.title,
          total = _ref.total,
          vat = _ref.vat;
      var builder = new _AdaptiveCardBuilder.default(adaptiveCards, styleOptions);
      var HorizontalAlignment = adaptiveCards.HorizontalAlignment,
          TextSize = adaptiveCards.TextSize,
          TextWeight = adaptiveCards.TextWeight;
      var richCardWrapTitle = styleOptions.richCardWrapTitle;
      builder.addTextBlock(title, {
        size: TextSize.Medium,
        weight: TextWeight.Bolder,
        wrap: richCardWrapTitle
      });

      if (facts) {
        var _builder$addColumnSet = builder.addColumnSet([75, 25]),
            _builder$addColumnSet2 = (0, _slicedToArray2.default)(_builder$addColumnSet, 2),
            firstFactColumn = _builder$addColumnSet2[0],
            lastFactColumn = _builder$addColumnSet2[1]; // tslint:disable-next-line:no-unused-expression


        facts.map(function (_ref2) {
          var key = _ref2.key,
              value = _ref2.value;
          builder.addTextBlock(key, {
            size: TextSize.Medium
          }, firstFactColumn);
          builder.addTextBlock(value, {
            size: TextSize.Medium,
            horizontalAlignment: HorizontalAlignment.Right
          }, lastFactColumn);
        });
      } // tslint:disable-next-line:no-unused-expression


      items && items.map(function (_ref3) {
        var _ref3$image = _ref3.image;
        _ref3$image = _ref3$image === void 0 ? {} : _ref3$image;
        var tap = _ref3$image.tap,
            url = _ref3$image.url,
            price = _ref3.price,
            subtitle = _ref3.subtitle,
            title = _ref3.title;
        var itemColumns;

        if (url) {
          var _builder$addColumnSet3 = builder.addColumnSet([15, 75, 10]),
              _builder$addColumnSet4 = (0, _toArray2.default)(_builder$addColumnSet3),
              itemImageColumn = _builder$addColumnSet4[0],
              columns = _builder$addColumnSet4.slice(1);

          itemColumns = columns;
          builder.addImage(url, itemImageColumn, tap);
        } else {
          itemColumns = builder.addColumnSet([75, 25]);
        }

        var _itemColumns = itemColumns,
            _itemColumns2 = (0, _slicedToArray2.default)(_itemColumns, 2),
            itemTitleColumn = _itemColumns2[0],
            itemPriceColumn = _itemColumns2[1];

        builder.addTextBlock(title, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder,
          wrap: richCardWrapTitle
        }, itemTitleColumn);
        builder.addTextBlock(subtitle, {
          size: TextSize.Medium,
          wrap: richCardWrapTitle
        }, itemTitleColumn);
        builder.addTextBlock(price, {
          horizontalAlignment: HorizontalAlignment.Right
        }, itemPriceColumn);
      });

      if (!nullOrUndefined(vat)) {
        var vatCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock((0, _botframeworkWebchatComponent.localize)('VAT', language), {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, vatCol[0]);
        builder.addTextBlock(vat, {
          horizontalAlignment: HorizontalAlignment.Right
        }, vatCol[1]);
      }

      if (!nullOrUndefined(tax)) {
        var taxCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock((0, _botframeworkWebchatComponent.localize)('Tax', language), {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, taxCol[0]);
        builder.addTextBlock(tax, {
          horizontalAlignment: HorizontalAlignment.Right
        }, taxCol[1]);
      }

      if (!nullOrUndefined(total)) {
        var totalCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock((0, _botframeworkWebchatComponent.localize)('Total', language), {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[0]);
        builder.addTextBlock(total, {
          horizontalAlignment: HorizontalAlignment.Right,
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[1]);
      }

      builder.addButtons(buttons);
      return builder.card;
    });
    return _this;
  }

  (0, _createClass2.default)(ReceiptCardAttachment, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          adaptiveCardHostConfig = _this$props.adaptiveCardHostConfig,
          adaptiveCards = _this$props.adaptiveCards,
          _this$props$attachmen = _this$props.attachment;
      _this$props$attachmen = _this$props$attachmen === void 0 ? {} : _this$props$attachmen;
      var content = _this$props$attachmen.content,
          language = _this$props.language,
          options = _this$props.styleSet.options;
      return _react.default.createElement(_AdaptiveCardRenderer.default, {
        adaptiveCard: content && this.buildCard(adaptiveCards, content, language, options),
        adaptiveCardHostConfig: adaptiveCardHostConfig,
        tapAction: content && content.tap
      });
    }
  }]);
  return ReceiptCardAttachment;
}(_react.default.Component);

ReceiptCardAttachment.propTypes = {
  adaptiveCardHostConfig: _propTypes.default.any.isRequired,
  adaptiveCards: _propTypes.default.any.isRequired,
  attachment: _propTypes.default.shape({
    content: _propTypes.default.shape({
      buttons: _propTypes.default.array,
      fact: _propTypes.default.arrayOf(_propTypes.default.shape({
        key: _propTypes.default.string,
        value: _propTypes.default.string
      })),
      items: _propTypes.default.arrayOf(_propTypes.default.shape({
        image: _propTypes.default.shape({
          tap: _propTypes.default.any,
          url: _propTypes.default.string.isRequired
        }),
        price: _propTypes.default.string.isRequired,
        subtitle: _propTypes.default.string,
        title: _propTypes.default.string.isRequired
      })),
      tax: _propTypes.default.string,
      title: _propTypes.default.string,
      total: _propTypes.default.string,
      vat: _propTypes.default.string
    }).isRequired
  }).isRequired,
  language: _propTypes.default.string.isRequired,
  styleSet: _propTypes.default.shape({
    options: _propTypes.default.any.isRequired
  }).isRequired
};

var _default = (0, _botframeworkWebchatComponent.connectToWebChat)(function (_ref4) {
  var language = _ref4.language,
      styleSet = _ref4.styleSet;
  return {
    language: language,
    styleSet: styleSet
  };
})(ReceiptCardAttachment);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvUmVjZWlwdENhcmRBdHRhY2htZW50LmpzIl0sIm5hbWVzIjpbIm51bGxPclVuZGVmaW5lZCIsIm9iaiIsIlJlY2VpcHRDYXJkQXR0YWNobWVudCIsInByb3BzIiwiYnVpbGRDYXJkIiwiYWRhcHRpdmVDYXJkcyIsImxhbmd1YWdlIiwic3R5bGVPcHRpb25zIiwiYnV0dG9ucyIsImZhY3RzIiwiaXRlbXMiLCJ0YXgiLCJ0aXRsZSIsInRvdGFsIiwidmF0IiwiYnVpbGRlciIsIkFkYXB0aXZlQ2FyZEJ1aWxkZXIiLCJIb3Jpem9udGFsQWxpZ25tZW50IiwiVGV4dFNpemUiLCJUZXh0V2VpZ2h0IiwicmljaENhcmRXcmFwVGl0bGUiLCJhZGRUZXh0QmxvY2siLCJzaXplIiwiTWVkaXVtIiwid2VpZ2h0IiwiQm9sZGVyIiwid3JhcCIsImFkZENvbHVtblNldCIsImZpcnN0RmFjdENvbHVtbiIsImxhc3RGYWN0Q29sdW1uIiwibWFwIiwia2V5IiwidmFsdWUiLCJob3Jpem9udGFsQWxpZ25tZW50IiwiUmlnaHQiLCJpbWFnZSIsInRhcCIsInVybCIsInByaWNlIiwic3VidGl0bGUiLCJpdGVtQ29sdW1ucyIsIml0ZW1JbWFnZUNvbHVtbiIsImNvbHVtbnMiLCJhZGRJbWFnZSIsIml0ZW1UaXRsZUNvbHVtbiIsIml0ZW1QcmljZUNvbHVtbiIsInZhdENvbCIsInRheENvbCIsInRvdGFsQ29sIiwiYWRkQnV0dG9ucyIsImNhcmQiLCJhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnIiwiYXR0YWNobWVudCIsImNvbnRlbnQiLCJvcHRpb25zIiwic3R5bGVTZXQiLCJSZWFjdCIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImFueSIsImlzUmVxdWlyZWQiLCJzaGFwZSIsImFycmF5IiwiZmFjdCIsImFycmF5T2YiLCJzdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QlEsS0FBaEIsRUF1Qk5MO0FBeEJ1QixHQUFoQixFQXlCVEEsVUE1QjZCO0FBNkJoQ3ZELEVBQUFBLFFBQVEsRUFBRXFELG1CQUFVTyxNQUFWLENBQWlCTCxVQTdCSztBQThCaENOLEVBQUFBLFFBQVEsRUFBRUksbUJBQVVHLEtBQVYsQ0FBZ0I7QUFDeEJSLElBQUFBLE9BQU8sRUFBRUssbUJBQVVDLEdBQVYsQ0FBY0M7QUFEQyxHQUFoQixFQUVQQTtBQWhDNkIsQ0FBbEM7O2VBbUNlLG9EQUFpQjtBQUFBLE1BQUd2RCxRQUFILFNBQUdBLFFBQUg7QUFBQSxNQUFhaUQsUUFBYixTQUFhQSxRQUFiO0FBQUEsU0FBNkI7QUFBRWpELElBQUFBLFFBQVEsRUFBUkEsUUFBRjtBQUFZaUQsSUFBQUEsUUFBUSxFQUFSQTtBQUFaLEdBQTdCO0FBQUEsQ0FBakIsRUFBdUVyRCxxQkFBdkUsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBuby1tYWdpYy1udW1iZXJzOiBbXCJlcnJvclwiLCB7IFwiaWdub3JlXCI6IFswLCAxLCAxMCwgMTUsIDI1LCA3NV0gfV0gKi9cblxuaW1wb3J0IHsgY29ubmVjdFRvV2ViQ2hhdCwgbG9jYWxpemUgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb21wb25lbnQnO1xuaW1wb3J0IG1lbW9pemUgZnJvbSAnbWVtb2l6ZS1vbmUnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBBZGFwdGl2ZUNhcmRCdWlsZGVyIGZyb20gJy4vQWRhcHRpdmVDYXJkQnVpbGRlcic7XG5pbXBvcnQgQWRhcHRpdmVDYXJkUmVuZGVyZXIgZnJvbSAnLi9BZGFwdGl2ZUNhcmRSZW5kZXJlcic7XG5cbmZ1bmN0aW9uIG51bGxPclVuZGVmaW5lZChvYmopIHtcbiAgcmV0dXJuIG9iaiA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqID09PSAndW5kZWZpbmVkJztcbn1cblxuY2xhc3MgUmVjZWlwdENhcmRBdHRhY2htZW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmJ1aWxkQ2FyZCA9IG1lbW9pemUoXG4gICAgICAoYWRhcHRpdmVDYXJkcywgeyBidXR0b25zLCBmYWN0cywgaXRlbXMsIHRheCwgdGl0bGUsIHRvdGFsLCB2YXQgfSwgbGFuZ3VhZ2UsIHN0eWxlT3B0aW9ucykgPT4ge1xuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IEFkYXB0aXZlQ2FyZEJ1aWxkZXIoYWRhcHRpdmVDYXJkcywgc3R5bGVPcHRpb25zKTtcbiAgICAgICAgY29uc3QgeyBIb3Jpem9udGFsQWxpZ25tZW50LCBUZXh0U2l6ZSwgVGV4dFdlaWdodCB9ID0gYWRhcHRpdmVDYXJkcztcbiAgICAgICAgY29uc3QgeyByaWNoQ2FyZFdyYXBUaXRsZSB9ID0gc3R5bGVPcHRpb25zO1xuXG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHRpdGxlLCB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciwgd3JhcDogcmljaENhcmRXcmFwVGl0bGUgfSk7XG5cbiAgICAgICAgaWYgKGZhY3RzKSB7XG4gICAgICAgICAgY29uc3QgW2ZpcnN0RmFjdENvbHVtbiwgbGFzdEZhY3RDb2x1bW5dID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVudXNlZC1leHByZXNzaW9uXG4gICAgICAgICAgZmFjdHMubWFwKCh7IGtleSwgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soa2V5LCB7IHNpemU6IFRleHRTaXplLk1lZGl1bSB9LCBmaXJzdEZhY3RDb2x1bW4pO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgaG9yaXpvbnRhbEFsaWdubWVudDogSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodCB9LFxuICAgICAgICAgICAgICBsYXN0RmFjdENvbHVtblxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnVzZWQtZXhwcmVzc2lvblxuICAgICAgICBpdGVtcyAmJlxuICAgICAgICAgIGl0ZW1zLm1hcCgoeyBpbWFnZTogeyB0YXAsIHVybCB9ID0ge30sIHByaWNlLCBzdWJ0aXRsZSwgdGl0bGUgfSkgPT4ge1xuICAgICAgICAgICAgbGV0IGl0ZW1Db2x1bW5zO1xuXG4gICAgICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICAgIGNvbnN0IFtpdGVtSW1hZ2VDb2x1bW4sIC4uLmNvbHVtbnNdID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzE1LCA3NSwgMTBdKTtcblxuICAgICAgICAgICAgICBpdGVtQ29sdW1ucyA9IGNvbHVtbnM7XG4gICAgICAgICAgICAgIGJ1aWxkZXIuYWRkSW1hZ2UodXJsLCBpdGVtSW1hZ2VDb2x1bW4sIHRhcCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpdGVtQ29sdW1ucyA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgW2l0ZW1UaXRsZUNvbHVtbiwgaXRlbVByaWNlQ29sdW1uXSA9IGl0ZW1Db2x1bW5zO1xuXG4gICAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhcbiAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyLCB3cmFwOiByaWNoQ2FyZFdyYXBUaXRsZSB9LFxuICAgICAgICAgICAgICBpdGVtVGl0bGVDb2x1bW5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhzdWJ0aXRsZSwgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdyYXA6IHJpY2hDYXJkV3JhcFRpdGxlIH0sIGl0ZW1UaXRsZUNvbHVtbik7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhwcmljZSwgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIGl0ZW1QcmljZUNvbHVtbik7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFudWxsT3JVbmRlZmluZWQodmF0KSkge1xuICAgICAgICAgIGNvbnN0IHZhdENvbCA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdKTtcblxuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKFxuICAgICAgICAgICAgbG9jYWxpemUoJ1ZBVCcsIGxhbmd1YWdlKSxcbiAgICAgICAgICAgIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sXG4gICAgICAgICAgICB2YXRDb2xbMF1cbiAgICAgICAgICApO1xuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHZhdCwgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIHZhdENvbFsxXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIW51bGxPclVuZGVmaW5lZCh0YXgpKSB7XG4gICAgICAgICAgY29uc3QgdGF4Q29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgICBsb2NhbGl6ZSgnVGF4JywgbGFuZ3VhZ2UpLFxuICAgICAgICAgICAgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIgfSxcbiAgICAgICAgICAgIHRheENvbFswXVxuICAgICAgICAgICk7XG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2sodGF4LCB7IGhvcml6b250YWxBbGlnbm1lbnQ6IEhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQgfSwgdGF4Q29sWzFdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHRvdGFsKSkge1xuICAgICAgICAgIGNvbnN0IHRvdGFsQ29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgICBsb2NhbGl6ZSgnVG90YWwnLCBsYW5ndWFnZSksXG4gICAgICAgICAgICB7IHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciB9LFxuICAgICAgICAgICAgdG90YWxDb2xbMF1cbiAgICAgICAgICApO1xuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKFxuICAgICAgICAgICAgdG90YWwsXG4gICAgICAgICAgICB7IGhvcml6b250YWxBbGlnbm1lbnQ6IEhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQsIHNpemU6IFRleHRTaXplLk1lZGl1bSwgd2VpZ2h0OiBUZXh0V2VpZ2h0LkJvbGRlciB9LFxuICAgICAgICAgICAgdG90YWxDb2xbMV1cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgYnVpbGRlci5hZGRCdXR0b25zKGJ1dHRvbnMpO1xuXG4gICAgICAgIHJldHVybiBidWlsZGVyLmNhcmQ7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnLFxuICAgICAgYWRhcHRpdmVDYXJkcyxcbiAgICAgIGF0dGFjaG1lbnQ6IHsgY29udGVudCB9ID0ge30sXG4gICAgICBsYW5ndWFnZSxcbiAgICAgIHN0eWxlU2V0OiB7IG9wdGlvbnMgfVxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBZGFwdGl2ZUNhcmRSZW5kZXJlclxuICAgICAgICBhZGFwdGl2ZUNhcmQ9e2NvbnRlbnQgJiYgdGhpcy5idWlsZENhcmQoYWRhcHRpdmVDYXJkcywgY29udGVudCwgbGFuZ3VhZ2UsIG9wdGlvbnMpfVxuICAgICAgICBhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnPXthZGFwdGl2ZUNhcmRIb3N0Q29uZmlnfVxuICAgICAgICB0YXBBY3Rpb249e2NvbnRlbnQgJiYgY29udGVudC50YXB9XG4gICAgICAvPlxuICAgICk7XG4gIH1cbn1cblxuUmVjZWlwdENhcmRBdHRhY2htZW50LnByb3BUeXBlcyA9IHtcbiAgYWRhcHRpdmVDYXJkSG9zdENvbmZpZzogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkLFxuICBhZGFwdGl2ZUNhcmRzOiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWQsXG4gIGF0dGFjaG1lbnQ6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgY29udGVudDogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIGJ1dHRvbnM6IFByb3BUeXBlcy5hcnJheSxcbiAgICAgIGZhY3Q6IFByb3BUeXBlcy5hcnJheU9mKFxuICAgICAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICAgIGtleTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgICB2YWx1ZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIGl0ZW1zOiBQcm9wVHlwZXMuYXJyYXlPZihcbiAgICAgICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICBpbWFnZTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICAgIHRhcDogUHJvcFR5cGVzLmFueSxcbiAgICAgICAgICAgIHVybDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG4gICAgICAgICAgfSksXG4gICAgICAgICAgcHJpY2U6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgICBzdWJ0aXRsZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgICB0aXRsZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG4gICAgICAgIH0pXG4gICAgICApLFxuICAgICAgdGF4OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICB0b3RhbDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIHZhdDogUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0pLmlzUmVxdWlyZWRcbiAgfSkuaXNSZXF1aXJlZCxcbiAgbGFuZ3VhZ2U6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgc3R5bGVTZXQ6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgb3B0aW9uczogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkXG4gIH0pLmlzUmVxdWlyZWRcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb1dlYkNoYXQoKHsgbGFuZ3VhZ2UsIHN0eWxlU2V0IH0pID0+ICh7IGxhbmd1YWdlLCBzdHlsZVNldCB9KSkoUmVjZWlwdENhcmRBdHRhY2htZW50KTtcbiJdfQ==