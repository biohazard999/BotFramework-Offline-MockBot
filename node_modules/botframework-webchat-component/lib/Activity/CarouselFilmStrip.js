"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectCarouselFilmStrip = exports.default = void 0;

var _glamor = require("glamor");

var _reactFilm = require("react-film");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _Avatar = _interopRequireDefault(require("./Avatar"));

var _Bubble = _interopRequireDefault(require("./Bubble"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _SendStatus = _interopRequireDefault(require("./SendStatus"));

var _textFormatToContentType = _interopRequireDefault(require("../Utils/textFormatToContentType"));

var _Timestamp = _interopRequireDefault(require("./Timestamp"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

var _Constants$ActivityCl = _botframeworkWebchatCore.Constants.ActivityClientState,
    SENDING = _Constants$ActivityCl.SENDING,
    SEND_FAILED = _Constants$ActivityCl.SEND_FAILED;
var ROOT_CSS = (0, _glamor.css)({
  display: 'flex',
  MsOverflowStyle: 'none',
  overflowX: 'scroll',
  overflowY: 'hidden',
  touchAction: 'manipulation',
  WebkitOverflowScrolling: 'touch',
  '&::-webkit-scrollbar': {
    display: 'none'
  },
  '& > .avatar': {
    flexShrink: 0
  },
  '& > .content': {
    flex: 1,
    '& > .message': {
      display: 'flex',
      '& > .bubble': {
        flexGrow: 1,
        overflow: 'hidden'
      },
      '& > .filler': {
        flexGrow: 10000,
        flexShrink: 1
      }
    },
    '& > ul': {
      display: 'flex',
      listStyleType: 'none',
      margin: 0,
      padding: 0,
      '& > li': {
        flex: 1
      }
    }
  }
});

var connectCarouselFilmStrip = function connectCarouselFilmStrip() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var language = _ref.language,
        _ref$styleSet$options = _ref.styleSet.options,
        botAvatarInitials = _ref$styleSet$options.botAvatarInitials,
        userAvatarInitials = _ref$styleSet$options.userAvatarInitials;
    var _ref2$activity = _ref2.activity;
    _ref2$activity = _ref2$activity === void 0 ? {} : _ref2$activity;
    var _ref2$activity$from = _ref2$activity.from;
    _ref2$activity$from = _ref2$activity$from === void 0 ? {} : _ref2$activity$from;
    var role = _ref2$activity$from.role;
    return {
      avatarInitials: role === 'user' ? userAvatarInitials : botAvatarInitials,
      language: language
    };
  }].concat(selectors));
};

exports.connectCarouselFilmStrip = connectCarouselFilmStrip;

var WebChatCarouselFilmStrip = function WebChatCarouselFilmStrip(_ref3) {
  var activity = _ref3.activity,
      children = _ref3.children,
      className = _ref3.className,
      itemContainerRef = _ref3.itemContainerRef,
      scrollableRef = _ref3.scrollableRef,
      styleSet = _ref3.styleSet,
      timestampClassName = _ref3.timestampClassName;
  var _activity$attachments = activity.attachments,
      attachments = _activity$attachments === void 0 ? [] : _activity$attachments,
      _activity$channelData = activity.channelData;
  _activity$channelData = _activity$channelData === void 0 ? {} : _activity$channelData;
  var _activity$channelData2 = _activity$channelData.messageBack;
  _activity$channelData2 = _activity$channelData2 === void 0 ? {} : _activity$channelData2;
  var messageBackDisplayText = _activity$channelData2.displayText,
      state = _activity$channelData.state,
      _activity$from = activity.from;
  _activity$from = _activity$from === void 0 ? {} : _activity$from;
  var role = _activity$from.role,
      text = activity.text,
      textFormat = activity.textFormat;
  var fromUser = role === 'user';
  var activityDisplayText = messageBackDisplayText || text;
  return _react.default.createElement("div", {
    className: (0, _classnames.default)(ROOT_CSS + '', styleSet.carouselFilmStrip + '', className + ''),
    ref: scrollableRef
  }, _react.default.createElement(_Avatar.default, {
    "aria-hidden": true,
    className: "avatar",
    fromUser: fromUser
  }), _react.default.createElement("div", {
    className: "content"
  }, !!activityDisplayText && _react.default.createElement("div", {
    className: "message"
  }, _react.default.createElement(_Bubble.default, {
    "aria-hidden": true,
    className: "bubble",
    fromUser: fromUser
  }, children({
    activity: activity,
    attachment: {
      content: activityDisplayText,
      contentType: (0, _textFormatToContentType.default)(textFormat)
    }
  })), _react.default.createElement("div", {
    className: "filler"
  })), _react.default.createElement("ul", {
    ref: itemContainerRef
  }, attachments.map(function (attachment, index) {
    return _react.default.createElement("li", {
      key: index
    }, _react.default.createElement(_Bubble.default, {
      fromUser: fromUser,
      key: index
    }, children({
      attachment: attachment
    })));
  })), _react.default.createElement("div", {
    className: "webchat__row"
  }, state === SENDING || state === SEND_FAILED ? _react.default.createElement(_SendStatus.default, {
    activity: activity
  }) : _react.default.createElement(_Timestamp.default, {
    activity: activity,
    "aria-hidden": true,
    className: timestampClassName
  }))));
};

WebChatCarouselFilmStrip.defaultProps = {
  children: undefined,
  className: '',
  timestampClassName: ''
};
WebChatCarouselFilmStrip.propTypes = {
  activity: _propTypes.default.shape({
    attachments: _propTypes.default.array,
    channelData: _propTypes.default.shape({
      messageBack: _propTypes.default.shape({
        displayText: _propTypes.default.string
      }),
      state: _propTypes.default.string
    }),
    from: _propTypes.default.shape({
      role: _propTypes.default.string.isRequired
    }).isRequired,
    text: _propTypes.default.string,
    textFormat: _propTypes.default.string,
    timestamp: _propTypes.default.string
  }).isRequired,
  children: _propTypes.default.any,
  className: _propTypes.default.string,
  itemContainerRef: _propTypes.default.any.isRequired,
  scrollableRef: _propTypes.default.any.isRequired,
  styleSet: _propTypes.default.shape({
    carouselFilmStrip: _propTypes.default.any.isRequired
  }).isRequired,
  timestampClassName: _propTypes.default.string
};
var ConnectedCarouselFilmStrip = connectCarouselFilmStrip(function (_ref4) {
  var avatarInitials = _ref4.avatarInitials,
      language = _ref4.language,
      styleSet = _ref4.styleSet;
  return {
    avatarInitials: avatarInitials,
    language: language,
    styleSet: styleSet
  };
})(WebChatCarouselFilmStrip);

var CarouselFilmStrip = function CarouselFilmStrip(props) {
  return _react.default.createElement(_reactFilm.Context.Consumer, null, function (_ref5) {
    var itemContainerRef = _ref5.itemContainerRef,
        scrollableRef = _ref5.scrollableRef;
    return _react.default.createElement(ConnectedCarouselFilmStrip, _extends({
      itemContainerRef: itemContainerRef,
      scrollableRef: scrollableRef
    }, props));
  });
};

var _default = CarouselFilmStrip;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9DYXJvdXNlbEZpbG1TdHJpcC5qcyJdLCJuYW1lcyI6WyJDb25zdGFudHMiLCJBY3Rpdml0eUNsaWVudFN0YXRlIiwiU0VORElORyIsIlNFTkRfRkFJTEVEIiwiUk9PVF9DU1MiLCJkaXNwbGF5IiwiTXNPdmVyZmxvd1N0eWxlIiwib3ZlcmZsb3dYIiwib3ZlcmZsb3dZIiwidG91Y2hBY3Rpb24iLCJXZWJraXRPdmVyZmxvd1Njcm9sbGluZyIsImZsZXhTaHJpbmsiLCJmbGV4IiwiZmxleEdyb3ciLCJvdmVyZmxvdyIsImxpc3RTdHlsZVR5cGUiLCJtYXJnaW4iLCJwYWRkaW5nIiwiY29ubmVjdENhcm91c2VsRmlsbVN0cmlwIiwic2VsZWN0b3JzIiwiY29ubmVjdFRvV2ViQ2hhdCIsImxhbmd1YWdlIiwic3R5bGVTZXQiLCJvcHRpb25zIiwiYm90QXZhdGFySW5pdGlhbHMiLCJ1c2VyQXZhdGFySW5pdGlhbHMiLCJhY3Rpdml0eSIsImZyb20iLCJyb2xlIiwiYXZhdGFySW5pdGlhbHMiLCJXZWJDaGF0Q2Fyb3VzZWxGaWxtU3RyaXAiLCJjaGlsZHJlbiIsImNsYXNzTmFtZSIsIml0ZW1Db250YWluZXJSZWYiLCJzY3JvbGxhYmxlUmVmIiwidGltZXN0YW1wQ2xhc3NOYW1lIiwiYXR0YWNobWVudHMiLCJjaGFubmVsRGF0YSIsIm1lc3NhZ2VCYWNrIiwibWVzc2FnZUJhY2tEaXNwbGF5VGV4dCIsImRpc3BsYXlUZXh0Iiwic3RhdGUiLCJ0ZXh0IiwidGV4dEZvcm1hdCIsImZyb21Vc2VyIiwiYWN0aXZpdHlEaXNwbGF5VGV4dCIsImNhcm91c2VsRmlsbVN0cmlwIiwiYXR0YWNobWVudCIsImNvbnRlbnQiLCJjb250ZW50VHlwZSIsIm1hcCIsImluZGV4IiwiZGVmYXVsdFByb3BzIiwidW5kZWZpbmVkIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic2hhcGUiLCJhcnJheSIsInN0cmluZyIsImlzUmVxdWlyZWQiLCJ0aW1lc3RhbXAiLCJhbnkiLCJDb25uZWN0ZWRDYXJvdXNlbEZpbG1TdHJpcCIsIkNhcm91c2VsRmlsbVN0cmlwIiwicHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7OzRCQUlJQSxrQyxDQURGQyxtQjtJQUF1QkMsTyx5QkFBQUEsTztJQUFTQyxXLHlCQUFBQSxXO0FBR2xDLElBQU1DLFFBQVEsR0FBRyxpQkFBSTtBQUNuQkMsRUFBQUEsT0FBTyxFQUFFLE1BRFU7QUFFbkJDLEVBQUFBLGVBQWUsRUFBRSxNQUZFO0FBR25CQyxFQUFBQSxTQUFTLEVBQUUsUUFIUTtBQUluQkMsRUFBQUEsU0FBUyxFQUFFLFFBSlE7QUFLbkJDLEVBQUFBLFdBQVcsRUFBRSxjQUxNO0FBTW5CQyxFQUFBQSx1QkFBdUIsRUFBRSxPQU5OO0FBUW5CLDBCQUF3QjtBQUN0QkwsSUFBQUEsT0FBTyxFQUFFO0FBRGEsR0FSTDtBQVluQixpQkFBZTtBQUNiTSxJQUFBQSxVQUFVLEVBQUU7QUFEQyxHQVpJO0FBZ0JuQixrQkFBZ0I7QUFDZEMsSUFBQUEsSUFBSSxFQUFFLENBRFE7QUFHZCxvQkFBZ0I7QUFDZFAsTUFBQUEsT0FBTyxFQUFFLE1BREs7QUFHZCxxQkFBZTtBQUNiUSxRQUFBQSxRQUFRLEVBQUUsQ0FERztBQUViQyxRQUFBQSxRQUFRLEVBQUU7QUFGRyxPQUhEO0FBUWQscUJBQWU7QUFDYkQsUUFBQUEsUUFBUSxFQUFFLEtBREc7QUFFYkYsUUFBQUEsVUFBVSxFQUFFO0FBRkM7QUFSRCxLQUhGO0FBaUJkLGNBQVU7QUFDUk4sTUFBQUEsT0FBTyxFQUFFLE1BREQ7QUFFUlUsTUFBQUEsYUFBYSxFQUFFLE1BRlA7QUFHUkMsTUFBQUEsTUFBTSxFQUFFLENBSEE7QUFJUkMsTUFBQUEsT0FBTyxFQUFFLENBSkQ7QUFNUixnQkFBVTtBQUNSTCxRQUFBQSxJQUFJLEVBQUU7QUFERTtBQU5GO0FBakJJ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aUJBQWlCLEdBQUcsU0FBcEJBLGlCQUFvQixDQUFBQyxLQUFLO0FBQUEsU0FDN0IsNkJBQUMsa0JBQUQsQ0FBYSxRQUFiLFFBQ0c7QUFBQSxRQUFHL0IsZ0JBQUgsU0FBR0EsZ0JBQUg7QUFBQSxRQUFxQkMsYUFBckIsU0FBcUJBLGFBQXJCO0FBQUEsV0FDQyw2QkFBQywwQkFBRDtBQUE0QixNQUFBLGdCQUFnQixFQUFFRCxnQkFBOUM7QUFBZ0UsTUFBQSxhQUFhLEVBQUVDO0FBQS9FLE9BQWtHOEIsS0FBbEcsRUFERDtBQUFBLEdBREgsQ0FENkI7QUFBQSxDQUEvQjs7ZUFRZUQsaUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgcmVhY3Qvbm8tYXJyYXktaW5kZXgta2V5OiBcIm9mZlwiICovXG5cbmltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcic7XG5pbXBvcnQgeyBDb250ZXh0IGFzIEZpbG1Db250ZXh0IH0gZnJvbSAncmVhY3QtZmlsbSc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcblxuaW1wb3J0IEF2YXRhciBmcm9tICcuL0F2YXRhcic7XG5pbXBvcnQgQnViYmxlIGZyb20gJy4vQnViYmxlJztcbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4uL2Nvbm5lY3RUb1dlYkNoYXQnO1xuaW1wb3J0IFNlbmRTdGF0dXMgZnJvbSAnLi9TZW5kU3RhdHVzJztcbmltcG9ydCB0ZXh0Rm9ybWF0VG9Db250ZW50VHlwZSBmcm9tICcuLi9VdGlscy90ZXh0Rm9ybWF0VG9Db250ZW50VHlwZSc7XG5pbXBvcnQgVGltZXN0YW1wIGZyb20gJy4vVGltZXN0YW1wJztcblxuY29uc3Qge1xuICBBY3Rpdml0eUNsaWVudFN0YXRlOiB7IFNFTkRJTkcsIFNFTkRfRkFJTEVEIH1cbn0gPSBDb25zdGFudHM7XG5cbmNvbnN0IFJPT1RfQ1NTID0gY3NzKHtcbiAgZGlzcGxheTogJ2ZsZXgnLFxuICBNc092ZXJmbG93U3R5bGU6ICdub25lJyxcbiAgb3ZlcmZsb3dYOiAnc2Nyb2xsJyxcbiAgb3ZlcmZsb3dZOiAnaGlkZGVuJyxcbiAgdG91Y2hBY3Rpb246ICdtYW5pcHVsYXRpb24nLFxuICBXZWJraXRPdmVyZmxvd1Njcm9sbGluZzogJ3RvdWNoJyxcblxuICAnJjo6LXdlYmtpdC1zY3JvbGxiYXInOiB7XG4gICAgZGlzcGxheTogJ25vbmUnXG4gIH0sXG5cbiAgJyYgPiAuYXZhdGFyJzoge1xuICAgIGZsZXhTaHJpbms6IDBcbiAgfSxcblxuICAnJiA+IC5jb250ZW50Jzoge1xuICAgIGZsZXg6IDEsXG5cbiAgICAnJiA+IC5tZXNzYWdlJzoge1xuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuXG4gICAgICAnJiA+IC5idWJibGUnOiB7XG4gICAgICAgIGZsZXhHcm93OiAxLFxuICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgICAgIH0sXG5cbiAgICAgICcmID4gLmZpbGxlcic6IHtcbiAgICAgICAgZmxleEdyb3c6IDEwMDAwLFxuICAgICAgICBmbGV4U2hyaW5rOiAxXG4gICAgICB9XG4gICAgfSxcblxuICAgICcmID4gdWwnOiB7XG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBsaXN0U3R5bGVUeXBlOiAnbm9uZScsXG4gICAgICBtYXJnaW46IDAsXG4gICAgICBwYWRkaW5nOiAwLFxuXG4gICAgICAnJiA+IGxpJzoge1xuICAgICAgICBmbGV4OiAxXG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcblxuY29uc3QgY29ubmVjdENhcm91c2VsRmlsbVN0cmlwID0gKC4uLnNlbGVjdG9ycykgPT5cbiAgY29ubmVjdFRvV2ViQ2hhdChcbiAgICAoXG4gICAgICB7XG4gICAgICAgIGxhbmd1YWdlLFxuICAgICAgICBzdHlsZVNldDoge1xuICAgICAgICAgIG9wdGlvbnM6IHsgYm90QXZhdGFySW5pdGlhbHMsIHVzZXJBdmF0YXJJbml0aWFscyB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7IGFjdGl2aXR5OiB7IGZyb206IHsgcm9sZSB9ID0ge30gfSA9IHt9IH1cbiAgICApID0+ICh7XG4gICAgICBhdmF0YXJJbml0aWFsczogcm9sZSA9PT0gJ3VzZXInID8gdXNlckF2YXRhckluaXRpYWxzIDogYm90QXZhdGFySW5pdGlhbHMsXG4gICAgICBsYW5ndWFnZVxuICAgIH0pLFxuICAgIC4uLnNlbGVjdG9yc1xuICApO1xuXG5jb25zdCBXZWJDaGF0Q2Fyb3VzZWxGaWxtU3RyaXAgPSAoe1xuICBhY3Rpdml0eSxcbiAgY2hpbGRyZW4sXG4gIGNsYXNzTmFtZSxcbiAgaXRlbUNvbnRhaW5lclJlZixcbiAgc2Nyb2xsYWJsZVJlZixcbiAgc3R5bGVTZXQsXG4gIHRpbWVzdGFtcENsYXNzTmFtZVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgYXR0YWNobWVudHMgPSBbXSxcbiAgICBjaGFubmVsRGF0YTogeyBtZXNzYWdlQmFjazogeyBkaXNwbGF5VGV4dDogbWVzc2FnZUJhY2tEaXNwbGF5VGV4dCB9ID0ge30sIHN0YXRlIH0gPSB7fSxcbiAgICBmcm9tOiB7IHJvbGUgfSA9IHt9LFxuICAgIHRleHQsXG4gICAgdGV4dEZvcm1hdFxuICB9ID0gYWN0aXZpdHk7XG5cbiAgY29uc3QgZnJvbVVzZXIgPSByb2xlID09PSAndXNlcic7XG4gIGNvbnN0IGFjdGl2aXR5RGlzcGxheVRleHQgPSBtZXNzYWdlQmFja0Rpc3BsYXlUZXh0IHx8IHRleHQ7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhST09UX0NTUyArICcnLCBzdHlsZVNldC5jYXJvdXNlbEZpbG1TdHJpcCArICcnLCBjbGFzc05hbWUgKyAnJyl9IHJlZj17c2Nyb2xsYWJsZVJlZn0+XG4gICAgICA8QXZhdGFyIGFyaWEtaGlkZGVuPXt0cnVlfSBjbGFzc05hbWU9XCJhdmF0YXJcIiBmcm9tVXNlcj17ZnJvbVVzZXJ9IC8+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnRlbnRcIj5cbiAgICAgICAgeyEhYWN0aXZpdHlEaXNwbGF5VGV4dCAmJiAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtZXNzYWdlXCI+XG4gICAgICAgICAgICA8QnViYmxlIGFyaWEtaGlkZGVuPXt0cnVlfSBjbGFzc05hbWU9XCJidWJibGVcIiBmcm9tVXNlcj17ZnJvbVVzZXJ9PlxuICAgICAgICAgICAgICB7Y2hpbGRyZW4oe1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5LFxuICAgICAgICAgICAgICAgIGF0dGFjaG1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGFjdGl2aXR5RGlzcGxheVRleHQsXG4gICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogdGV4dEZvcm1hdFRvQ29udGVudFR5cGUodGV4dEZvcm1hdClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9CdWJibGU+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZpbGxlclwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICl9XG4gICAgICAgIDx1bCByZWY9e2l0ZW1Db250YWluZXJSZWZ9PlxuICAgICAgICAgIHthdHRhY2htZW50cy5tYXAoKGF0dGFjaG1lbnQsIGluZGV4KSA9PiAoXG4gICAgICAgICAgICA8bGkga2V5PXtpbmRleH0+XG4gICAgICAgICAgICAgIDxCdWJibGUgZnJvbVVzZXI9e2Zyb21Vc2VyfSBrZXk9e2luZGV4fT5cbiAgICAgICAgICAgICAgICB7Y2hpbGRyZW4oeyBhdHRhY2htZW50IH0pfVxuICAgICAgICAgICAgICA8L0J1YmJsZT5cbiAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgKSl9XG4gICAgICAgIDwvdWw+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid2ViY2hhdF9fcm93XCI+XG4gICAgICAgICAge3N0YXRlID09PSBTRU5ESU5HIHx8IHN0YXRlID09PSBTRU5EX0ZBSUxFRCA/IChcbiAgICAgICAgICAgIDxTZW5kU3RhdHVzIGFjdGl2aXR5PXthY3Rpdml0eX0gLz5cbiAgICAgICAgICApIDogKFxuICAgICAgICAgICAgPFRpbWVzdGFtcCBhY3Rpdml0eT17YWN0aXZpdHl9IGFyaWEtaGlkZGVuPXt0cnVlfSBjbGFzc05hbWU9e3RpbWVzdGFtcENsYXNzTmFtZX0gLz5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApO1xufTtcblxuV2ViQ2hhdENhcm91c2VsRmlsbVN0cmlwLmRlZmF1bHRQcm9wcyA9IHtcbiAgY2hpbGRyZW46IHVuZGVmaW5lZCxcbiAgY2xhc3NOYW1lOiAnJyxcbiAgdGltZXN0YW1wQ2xhc3NOYW1lOiAnJ1xufTtcblxuV2ViQ2hhdENhcm91c2VsRmlsbVN0cmlwLnByb3BUeXBlcyA9IHtcbiAgYWN0aXZpdHk6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgYXR0YWNobWVudHM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBjaGFubmVsRGF0YTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIG1lc3NhZ2VCYWNrOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBkaXNwbGF5VGV4dDogUHJvcFR5cGVzLnN0cmluZ1xuICAgICAgfSksXG4gICAgICBzdGF0ZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0pLFxuICAgIGZyb206IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICByb2xlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWRcbiAgICB9KS5pc1JlcXVpcmVkLFxuICAgIHRleHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGV4dEZvcm1hdDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB0aW1lc3RhbXA6IFByb3BUeXBlcy5zdHJpbmdcbiAgfSkuaXNSZXF1aXJlZCxcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgaXRlbUNvbnRhaW5lclJlZjogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkLFxuICBzY3JvbGxhYmxlUmVmOiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWQsXG4gIHN0eWxlU2V0OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGNhcm91c2VsRmlsbVN0cmlwOiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWRcbiAgfSkuaXNSZXF1aXJlZCxcbiAgdGltZXN0YW1wQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nXG59O1xuXG5jb25zdCBDb25uZWN0ZWRDYXJvdXNlbEZpbG1TdHJpcCA9IGNvbm5lY3RDYXJvdXNlbEZpbG1TdHJpcCgoeyBhdmF0YXJJbml0aWFscywgbGFuZ3VhZ2UsIHN0eWxlU2V0IH0pID0+ICh7XG4gIGF2YXRhckluaXRpYWxzLFxuICBsYW5ndWFnZSxcbiAgc3R5bGVTZXRcbn0pKShXZWJDaGF0Q2Fyb3VzZWxGaWxtU3RyaXApO1xuXG5jb25zdCBDYXJvdXNlbEZpbG1TdHJpcCA9IHByb3BzID0+IChcbiAgPEZpbG1Db250ZXh0LkNvbnN1bWVyPlxuICAgIHsoeyBpdGVtQ29udGFpbmVyUmVmLCBzY3JvbGxhYmxlUmVmIH0pID0+IChcbiAgICAgIDxDb25uZWN0ZWRDYXJvdXNlbEZpbG1TdHJpcCBpdGVtQ29udGFpbmVyUmVmPXtpdGVtQ29udGFpbmVyUmVmfSBzY3JvbGxhYmxlUmVmPXtzY3JvbGxhYmxlUmVmfSB7Li4ucHJvcHN9IC8+XG4gICAgKX1cbiAgPC9GaWxtQ29udGV4dC5Db25zdW1lcj5cbik7XG5cbmV4cG9ydCBkZWZhdWx0IENhcm91c2VsRmlsbVN0cmlwO1xuXG5leHBvcnQgeyBjb25uZWN0Q2Fyb3VzZWxGaWxtU3RyaXAgfTtcbiJdfQ==