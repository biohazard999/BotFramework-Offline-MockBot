"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _reactDictateButton = require("react-dictate-button");

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _connectToWebChat = _interopRequireDefault(require("./connectToWebChat"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

var _Constants$DictateSta = _botframeworkWebchatCore.Constants.DictateState,
    DICTATING = _Constants$DictateSta.DICTATING,
    IDLE = _Constants$DictateSta.IDLE,
    STARTING = _Constants$DictateSta.STARTING;

var Dictation =
/*#__PURE__*/
function (_React$Component) {
  _inherits(Dictation, _React$Component);

  function Dictation(props) {
    var _this;

    _classCallCheck(this, Dictation);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(Dictation).call(this, props));
    _this.handleDictate = _this.handleDictate.bind(_assertThisInitialized(_this));
    _this.handleDictating = _this.handleDictating.bind(_assertThisInitialized(_this));
    _this.handleError = _this.handleError.bind(_assertThisInitialized(_this));
    return _this;
  }

  _createClass(Dictation, [{
    key: "handleDictate",
    value: function handleDictate(_ref) {
      var _ref$result = _ref.result;
      _ref$result = _ref$result === void 0 ? {} : _ref$result;
      var transcript = _ref$result.transcript;
      var _this$props = this.props,
          dictateState = _this$props.dictateState,
          setDictateInterims = _this$props.setDictateInterims,
          setDictateState = _this$props.setDictateState,
          setSendBox = _this$props.setSendBox,
          startSpeakingActivity = _this$props.startSpeakingActivity,
          stopDictate = _this$props.stopDictate,
          submitSendBox = _this$props.submitSendBox;

      if (dictateState === DICTATING || dictateState === STARTING) {
        setDictateInterims([]);
        setDictateState(IDLE);
        stopDictate();

        if (transcript) {
          setSendBox(transcript);
          submitSendBox('speech');
          startSpeakingActivity();
        }
      }
    }
  }, {
    key: "handleDictating",
    value: function handleDictating(_ref2) {
      var _ref2$results = _ref2.results,
          results = _ref2$results === void 0 ? [] : _ref2$results;
      var _this$props2 = this.props,
          dictateState = _this$props2.dictateState,
          postActivity = _this$props2.postActivity,
          sendTypingIndicator = _this$props2.sendTypingIndicator,
          setDictateInterims = _this$props2.setDictateInterims,
          setDictateState = _this$props2.setDictateState;

      if (dictateState === DICTATING || dictateState === STARTING) {
        var interims = results.map(function (_ref3) {
          var transcript = _ref3.transcript;
          return transcript;
        });
        setDictateInterims(interims);
        setDictateState(DICTATING);
        sendTypingIndicator && postActivity({
          type: 'typing'
        });
      }
    }
  }, {
    key: "handleError",
    value: function handleError(event) {
      var _this$props3 = this.props,
          dictateState = _this$props3.dictateState,
          onError = _this$props3.onError,
          setDictateState = _this$props3.setDictateState,
          stopDictate = _this$props3.stopDictate;

      if (dictateState === DICTATING || dictateState === STARTING) {
        setDictateState(IDLE);
        stopDictate();
        onError && onError(event);
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props4 = this.props,
          dictateState = _this$props4.dictateState,
          disabled = _this$props4.disabled,
          language = _this$props4.language,
          numSpeakingActivities = _this$props4.numSpeakingActivities,
          _this$props4$webSpeec = _this$props4.webSpeechPonyfill;
      _this$props4$webSpeec = _this$props4$webSpeec === void 0 ? {} : _this$props4$webSpeec;
      var SpeechGrammarList = _this$props4$webSpeec.SpeechGrammarList,
          SpeechRecognition = _this$props4$webSpeec.SpeechRecognition,
          handleDictate = this.handleDictate,
          handleDictating = this.handleDictating,
          handleError = this.handleError;
      return _react.default.createElement(_reactDictateButton.Composer, {
        lang: language,
        onDictate: handleDictate,
        onError: handleError,
        onProgress: handleDictating,
        speechGrammarList: SpeechGrammarList,
        speechRecognition: SpeechRecognition,
        started: !disabled && (dictateState === STARTING || dictateState === DICTATING) && !numSpeakingActivities
      });
    }
  }]);

  return Dictation;
}(_react.default.Component);

Dictation.defaultProps = {
  disabled: false,
  onError: undefined,
  webSpeechPonyfill: undefined
};
Dictation.propTypes = {
  dictateState: _propTypes.default.number.isRequired,
  disabled: _propTypes.default.bool,
  language: _propTypes.default.string.isRequired,
  numSpeakingActivities: _propTypes.default.number.isRequired,
  onError: _propTypes.default.func,
  postActivity: _propTypes.default.func.isRequired,
  setDictateInterims: _propTypes.default.func.isRequired,
  setDictateState: _propTypes.default.func.isRequired,
  setSendBox: _propTypes.default.func.isRequired,
  startSpeakingActivity: _propTypes.default.func.isRequired,
  stopDictate: _propTypes.default.func.isRequired,
  submitSendBox: _propTypes.default.func.isRequired,
  webSpeechPonyfill: _propTypes.default.shape({
    SpeechGrammarList: _propTypes.default.any.isRequired,
    SpeechRecognition: _propTypes.default.any.isRequired
  })
};

var _default = (0, _connectToWebChat.default)(function (_ref4) {
  var activities = _ref4.activities,
      dictateState = _ref4.dictateState,
      disabled = _ref4.disabled,
      language = _ref4.language,
      postActivity = _ref4.postActivity,
      sendTypingIndicator = _ref4.sendTypingIndicator,
      setDictateInterims = _ref4.setDictateInterims,
      setDictateState = _ref4.setDictateState,
      setSendBox = _ref4.setSendBox,
      startSpeakingActivity = _ref4.startSpeakingActivity,
      stopDictate = _ref4.stopDictate,
      submitSendBox = _ref4.submitSendBox,
      webSpeechPonyfill = _ref4.webSpeechPonyfill;
  return {
    dictateState: dictateState,
    disabled: disabled,
    language: language,
    numSpeakingActivities: activities.filter(function (_ref5) {
      var _ref5$channelData = _ref5.channelData;
      _ref5$channelData = _ref5$channelData === void 0 ? {} : _ref5$channelData;
      var speak = _ref5$channelData.speak;
      return speak;
    }).length,
    postActivity: postActivity,
    sendTypingIndicator: sendTypingIndicator,
    setDictateInterims: setDictateInterims,
    setDictateState: setDictateState,
    setSendBox: setSendBox,
    startSpeakingActivity: startSpeakingActivity,
    stopDictate: stopDictate,
    submitSendBox: submitSendBox,
    webSpeechPonyfill: webSpeechPonyfill
  };
})(Dictation);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EaWN0YXRpb24uanMiXSwibmFtZXMiOlsiQ29uc3RhbnRzIiwiRGljdGF0ZVN0YXRlIiwiRElDVEFUSU5HIiwiSURMRSIsIlNUQVJUSU5HIiwiRGljdGF0aW9uIiwicHJvcHMiLCJoYW5kbGVEaWN0YXRlIiwiYmluZCIsImhhbmRsZURpY3RhdGluZyIsImhhbmRsZUVycm9yIiwicmVzdWx0IiwidHJhbnNjcmlwdCIsImRpY3RhdGVTdGF0ZSIsInNldERpY3RhdGVJbnRlcmltcyIsInNldERpY3RhdGVTdGF0ZSIsInNldFNlbmRCb3giLCJzdGFydFNwZWFraW5nQWN0aXZpdHkiLCJzdG9wRGljdGF0ZSIsInN1Ym1pdFNlbmRCb3giLCJyZXN1bHRzIiwicG9zdEFjdGl2aXR5Iiwic2VuZFR5cGluZ0luZGljYXRvciIsImludGVyaW1zIiwibWFwIiwidHlwZSIsImV2ZW50Iiwib25FcnJvciIsImRpc2FibGVkIiwibGFuZ3VhZ2UiLCJudW1TcGVha2luZ0FjdGl2aXRpZXMiLCJ3ZWJTcGVlY2hQb255ZmlsbCIsIlNwZWVjaEdyYW1tYXJMaXN0IiwiU3BlZWNoUmVjb2duaXRpb24iLCJSZWFjdCIsIkNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJib29sIiwic3RyaW5nIiwiZnVuYyIsInNoYXBlIiwiYW55IiwiYWN0aXZpdGllcyIsImZpbHRlciIsImNoYW5uZWxEYXRhIiwic3BlYWsiLCJsZW5ndGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0QkFJSUEsa0MsQ0FERkMsWTtJQUFnQkMsUyx5QkFBQUEsUztJQUFXQyxJLHlCQUFBQSxJO0lBQU1DLFEseUJBQUFBLFE7O0lBRzdCQyxTOzs7OztBQUNKLHFCQUFZQyxLQUFaLEVBQW1CO0FBQUE7O0FBQUE7O0FB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LFNBY087QUFDTGxCLElBQUFBLFlBQVksRUFBWkEsWUFESztBQUVMZSxJQUFBQSxRQUFRLEVBQVJBLFFBRks7QUFHTEMsSUFBQUEsUUFBUSxFQUFSQSxRQUhLO0FBSUxDLElBQUFBLHFCQUFxQixFQUFFaUIsVUFBVSxDQUFDQyxNQUFYLENBQWtCO0FBQUEsb0NBQUdDLFdBQUg7QUFBQSx5REFBNEIsRUFBNUI7QUFBQSxVQUFrQkMsS0FBbEIscUJBQWtCQSxLQUFsQjtBQUFBLGFBQXFDQSxLQUFyQztBQUFBLEtBQWxCLEVBQThEQyxNQUpoRjtBQUtMOUIsSUFBQUEsWUFBWSxFQUFaQSxZQUxLO0FBTUxDLElBQUFBLG1CQUFtQixFQUFuQkEsbUJBTks7QUFPTFIsSUFBQUEsa0JBQWtCLEVBQWxCQSxrQkFQSztBQVFMQyxJQUFBQSxlQUFlLEVBQWZBLGVBUks7QUFTTEMsSUFBQUEsVUFBVSxFQUFWQSxVQVRLO0FBVUxDLElBQUFBLHFCQUFxQixFQUFyQkEscUJBVks7QUFXTEMsSUFBQUEsV0FBVyxFQUFYQSxXQVhLO0FBWUxDLElBQUFBLGFBQWEsRUFBYkEsYUFaSztBQWFMWSxJQUFBQSxpQkFBaUIsRUFBakJBO0FBYkssR0FkUDtBQUFBLENBRGEsRUE4QmIxQixTQTlCYSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9zZXIgYXMgRGljdGF0ZUNvbXBvc2VyIH0gZnJvbSAncmVhY3QtZGljdGF0ZS1idXR0b24nO1xuaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29yZSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IGNvbm5lY3RUb1dlYkNoYXQgZnJvbSAnLi9jb25uZWN0VG9XZWJDaGF0JztcblxuY29uc3Qge1xuICBEaWN0YXRlU3RhdGU6IHsgRElDVEFUSU5HLCBJRExFLCBTVEFSVElORyB9XG59ID0gQ29uc3RhbnRzO1xuXG5jbGFzcyBEaWN0YXRpb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuaGFuZGxlRGljdGF0ZSA9IHRoaXMuaGFuZGxlRGljdGF0ZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRGljdGF0aW5nID0gdGhpcy5oYW5kbGVEaWN0YXRpbmcuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUVycm9yID0gdGhpcy5oYW5kbGVFcnJvci5iaW5kKHRoaXMpO1xuICB9XG5cbiAgaGFuZGxlRGljdGF0ZSh7IHJlc3VsdDogeyB0cmFuc2NyaXB0IH0gPSB7fSB9KSB7XG4gICAgY29uc3Qge1xuICAgICAgZGljdGF0ZVN0YXRlLFxuICAgICAgc2V0RGljdGF0ZUludGVyaW1zLFxuICAgICAgc2V0RGljdGF0ZVN0YXRlLFxuICAgICAgc2V0U2VuZEJveCxcbiAgICAgIHN0YXJ0U3BlYWtpbmdBY3Rpdml0eSxcbiAgICAgIHN0b3BEaWN0YXRlLFxuICAgICAgc3VibWl0U2VuZEJveFxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGRpY3RhdGVTdGF0ZSA9PT0gRElDVEFUSU5HIHx8IGRpY3RhdGVTdGF0ZSA9PT0gU1RBUlRJTkcpIHtcbiAgICAgIHNldERpY3RhdGVJbnRlcmltcyhbXSk7XG4gICAgICBzZXREaWN0YXRlU3RhdGUoSURMRSk7XG4gICAgICBzdG9wRGljdGF0ZSgpO1xuXG4gICAgICBpZiAodHJhbnNjcmlwdCkge1xuICAgICAgICBzZXRTZW5kQm94KHRyYW5zY3JpcHQpO1xuICAgICAgICBzdWJtaXRTZW5kQm94KCdzcGVlY2gnKTtcbiAgICAgICAgc3RhcnRTcGVha2luZ0FjdGl2aXR5KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlRGljdGF0aW5nKHsgcmVzdWx0cyA9IFtdIH0pIHtcbiAgICBjb25zdCB7IGRpY3RhdGVTdGF0ZSwgcG9zdEFjdGl2aXR5LCBzZW5kVHlwaW5nSW5kaWNhdG9yLCBzZXREaWN0YXRlSW50ZXJpbXMsIHNldERpY3RhdGVTdGF0ZSB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChkaWN0YXRlU3RhdGUgPT09IERJQ1RBVElORyB8fCBkaWN0YXRlU3RhdGUgPT09IFNUQVJUSU5HKSB7XG4gICAgICBjb25zdCBpbnRlcmltcyA9IHJlc3VsdHMubWFwKCh7IHRyYW5zY3JpcHQgfSkgPT4gdHJhbnNjcmlwdCk7XG5cbiAgICAgIHNldERpY3RhdGVJbnRlcmltcyhpbnRlcmltcyk7XG4gICAgICBzZXREaWN0YXRlU3RhdGUoRElDVEFUSU5HKTtcbiAgICAgIHNlbmRUeXBpbmdJbmRpY2F0b3IgJiYgcG9zdEFjdGl2aXR5KHsgdHlwZTogJ3R5cGluZycgfSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlRXJyb3IoZXZlbnQpIHtcbiAgICBjb25zdCB7IGRpY3RhdGVTdGF0ZSwgb25FcnJvciwgc2V0RGljdGF0ZVN0YXRlLCBzdG9wRGljdGF0ZSB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChkaWN0YXRlU3RhdGUgPT09IERJQ1RBVElORyB8fCBkaWN0YXRlU3RhdGUgPT09IFNUQVJUSU5HKSB7XG4gICAgICBzZXREaWN0YXRlU3RhdGUoSURMRSk7XG4gICAgICBzdG9wRGljdGF0ZSgpO1xuXG4gICAgICBvbkVycm9yICYmIG9uRXJyb3IoZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBwcm9wczoge1xuICAgICAgICBkaWN0YXRlU3RhdGUsXG4gICAgICAgIGRpc2FibGVkLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgbnVtU3BlYWtpbmdBY3Rpdml0aWVzLFxuICAgICAgICB3ZWJTcGVlY2hQb255ZmlsbDogeyBTcGVlY2hHcmFtbWFyTGlzdCwgU3BlZWNoUmVjb2duaXRpb24gfSA9IHt9XG4gICAgICB9LFxuICAgICAgaGFuZGxlRGljdGF0ZSxcbiAgICAgIGhhbmRsZURpY3RhdGluZyxcbiAgICAgIGhhbmRsZUVycm9yXG4gICAgfSA9IHRoaXM7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPERpY3RhdGVDb21wb3NlclxuICAgICAgICBsYW5nPXtsYW5ndWFnZX1cbiAgICAgICAgb25EaWN0YXRlPXtoYW5kbGVEaWN0YXRlfVxuICAgICAgICBvbkVycm9yPXtoYW5kbGVFcnJvcn1cbiAgICAgICAgb25Qcm9ncmVzcz17aGFuZGxlRGljdGF0aW5nfVxuICAgICAgICBzcGVlY2hHcmFtbWFyTGlzdD17U3BlZWNoR3JhbW1hckxpc3R9XG4gICAgICAgIHNwZWVjaFJlY29nbml0aW9uPXtTcGVlY2hSZWNvZ25pdGlvbn1cbiAgICAgICAgc3RhcnRlZD17IWRpc2FibGVkICYmIChkaWN0YXRlU3RhdGUgPT09IFNUQVJUSU5HIHx8IGRpY3RhdGVTdGF0ZSA9PT0gRElDVEFUSU5HKSAmJiAhbnVtU3BlYWtpbmdBY3Rpdml0aWVzfVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG5cbkRpY3RhdGlvbi5kZWZhdWx0UHJvcHMgPSB7XG4gIGRpc2FibGVkOiBmYWxzZSxcbiAgb25FcnJvcjogdW5kZWZpbmVkLFxuICB3ZWJTcGVlY2hQb255ZmlsbDogdW5kZWZpbmVkXG59O1xuXG5EaWN0YXRpb24ucHJvcFR5cGVzID0ge1xuICBkaWN0YXRlU3RhdGU6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICBsYW5ndWFnZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICBudW1TcGVha2luZ0FjdGl2aXRpZXM6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgb25FcnJvcjogUHJvcFR5cGVzLmZ1bmMsXG4gIHBvc3RBY3Rpdml0eTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgc2V0RGljdGF0ZUludGVyaW1zOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBzZXREaWN0YXRlU3RhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIHNldFNlbmRCb3g6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIHN0YXJ0U3BlYWtpbmdBY3Rpdml0eTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgc3RvcERpY3RhdGU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIHN1Ym1pdFNlbmRCb3g6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIHdlYlNwZWVjaFBvbnlmaWxsOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIFNwZWVjaEdyYW1tYXJMaXN0OiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWQsXG4gICAgU3BlZWNoUmVjb2duaXRpb246IFByb3BUeXBlcy5hbnkuaXNSZXF1aXJlZFxuICB9KVxufTtcblxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdFRvV2ViQ2hhdChcbiAgKHtcbiAgICBhY3Rpdml0aWVzLFxuICAgIGRpY3RhdGVTdGF0ZSxcbiAgICBkaXNhYmxlZCxcbiAgICBsYW5ndWFnZSxcbiAgICBwb3N0QWN0aXZpdHksXG4gICAgc2VuZFR5cGluZ0luZGljYXRvcixcbiAgICBzZXREaWN0YXRlSW50ZXJpbXMsXG4gICAgc2V0RGljdGF0ZVN0YXRlLFxuICAgIHNldFNlbmRCb3gsXG4gICAgc3RhcnRTcGVha2luZ0FjdGl2aXR5LFxuICAgIHN0b3BEaWN0YXRlLFxuICAgIHN1Ym1pdFNlbmRCb3gsXG4gICAgd2ViU3BlZWNoUG9ueWZpbGxcbiAgfSkgPT4gKHtcbiAgICBkaWN0YXRlU3RhdGUsXG4gICAgZGlzYWJsZWQsXG4gICAgbGFuZ3VhZ2UsXG4gICAgbnVtU3BlYWtpbmdBY3Rpdml0aWVzOiBhY3Rpdml0aWVzLmZpbHRlcigoeyBjaGFubmVsRGF0YTogeyBzcGVhayB9ID0ge30gfSkgPT4gc3BlYWspLmxlbmd0aCxcbiAgICBwb3N0QWN0aXZpdHksXG4gICAgc2VuZFR5cGluZ0luZGljYXRvcixcbiAgICBzZXREaWN0YXRlSW50ZXJpbXMsXG4gICAgc2V0RGljdGF0ZVN0YXRlLFxuICAgIHNldFNlbmRCb3gsXG4gICAgc3RhcnRTcGVha2luZ0FjdGl2aXR5LFxuICAgIHN0b3BEaWN0YXRlLFxuICAgIHN1Ym1pdFNlbmRCb3gsXG4gICAgd2ViU3BlZWNoUG9ueWZpbGxcbiAgfSlcbikoRGljdGF0aW9uKTtcbiJdfQ==