"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _Localize = require("../Localization/Localize");

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _Timer = _interopRequireDefault(require("./Timer"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

var TIMER_INTERVAL = 60000;

function nextTimer(date) {
  var time = new Date(date).getTime();
  var now = Date.now();
  return time > now ? time : now + TIMER_INTERVAL - (now - time) % TIMER_INTERVAL;
}

function getStateFromProps(_ref) {
  var language = _ref.language,
      value = _ref.value;
  return {
    text: (0, _Localize.localize)('X minutes ago', language, value),
    timer: nextTimer(value)
  };
}

var TimeAgo =
/*#__PURE__*/
function (_React$Component) {
  _inherits(TimeAgo, _React$Component);

  function TimeAgo(props) {
    var _this;

    _classCallCheck(this, TimeAgo);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(TimeAgo).call(this, props));
    _this.handleInterval = _this.handleInterval.bind(_assertThisInitialized(_this));
    _this.state = getStateFromProps(props);
    return _this;
  }

  _createClass(TimeAgo, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(_ref2) {
      var language = _ref2.language,
          value = _ref2.value;
      this.updateText({
        language: language,
        value: value
      });
    }
  }, {
    key: "handleInterval",
    value: function handleInterval() {
      var _this$props = this.props,
          language = _this$props.language,
          value = _this$props.value;
      this.updateText({
        language: language,
        value: value
      });
    }
  }, {
    key: "updateText",
    value: function updateText(_ref3) {
      var language = _ref3.language,
          value = _ref3.value;
      this.setState(function () {
        return getStateFromProps({
          language: language,
          value: value
        });
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$state = this.state,
          text = _this$state.text,
          timer = _this$state.timer;
      return _react.default.createElement(_react.default.Fragment, null, text, _react.default.createElement(_Timer.default, {
        at: timer,
        onInterval: this.handleInterval
      }));
    }
  }]);

  return TimeAgo;
}(_react.default.Component);

TimeAgo.propTypes = {
  language: _propTypes.default.string.isRequired,
  value: _propTypes.default.string.isRequired
};

var _default = (0, _connectToWebChat.default)(function (_ref4) {
  var language = _ref4.language;
  return {
    language: language
  };
})(TimeAgo);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9VdGlscy9UaW1lQWdvLmpzIl0sIm5hbWVzIjpbIlRJTUVSX0lOVEVSVkFMIiwibmV4dFRpbWVyIiwiZGF0ZSIsInRpbWUiLCJEYXRlIiwiZ2V0VGltZSIsIm5vdyIsImdldFN0YXRlRnJvbVByb3BzIiwibGFuZ3VhZ2UiLCJ2YWx1ZSIsInRleHQiLCJ0aW1lciIsIlRpbWVBZ28iLCJwcm9wcyIsImhhbmRsZUludGVydmFsIiwiYmluZCIsInN0YXRlIiwidXBkYXRlVGV4dCIsInNldFN0YXRlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxjQUFjLEdBQUcsS0FBdkI7O0FBRUEsU0FBU0MsU0FBVCxDQUFtQkMsSUFBbkIsRUFBeUI7QUFDdkIsTUFBTUMsSUFBSSxHQUFHLElBQUlDLElBQUosQ0FBU0YsSUFBVCxFQUFlRyxPQUFmLEVBQWI7QUFDQSxNQUFNQyxHQUFHLEdBQUdGLElBQUksQ0FBQ0UsR0FBTCxFQUFaO0FBRUEsU0FBT0gsSUFBSSxHQUFHRyxHQUFQLEdBQWFILElBQWIsR0FBb0JHLEdBQUcsR0FBR04sY0FBTixHQUF3QixDQUFDTSxHQUFHLEdBQUdILElBQVAsSUFBZUgsY0FBbEU7QUFDRDs7QUFFRCxTQUFTTyxpQkFBVCxPQUFnRDtBQUFBLE1BQW5CQyxRQUFtQixRQUFuQkEsUUFBbUI7QUFBQSxNQUFUQyxLQUFTLFFBQVRBLEtBQVM7QUFDOUMsU0FBTztBQUNMQyxJQUFBQSxJQUFJLEVBQUUsd0JBQVMsZUFBVCxFQUEwQkYsUUFBMUIsRUFBb0NDLEtBQXBDLENBREQ7QUFFTEUsSUFBQUEsS0FBSyxFQUFFVixTQUFTLENBQUNRLEtBQUQ7QUFGWCxHQUFQO0FBSUQ7O0lBRUtHLE87Ozs7O0FBQ0osbUJBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTs7QUFDakIsaUZBQU1BLEtBQU47QUFFQSxVQUFLQyxjQUFMLEdBQXNCLE1BQUtBLGNBQUwsQ0FBb0JDLElBQXBCLCtCQUF0QjtBQUVBLFVBQUtDLEtBQUwsR0FBYVQsaUJBQWlCLENBQUNNLEtBQUQsQ0FBOUI7QUFMaUI7QUFNbEI7Ozs7cURBRThDO0FBQUEsVUFBbkJMLFFBQW1CLFNBQW5CQSxRQUFtQjtBQUFBLFVBQVRDLEtBQVMsU0FBVEEsS0FBUztBQUM3QyxXQUFLUSxVQUFMLENBQWdCO0FBQUVULFFBQUFBLFFBQVEsRUFBUkEsUUFBRjtBQUFZQyxRQUFBQSxLQUFLLEVBQUxBO0FBQVosT0FBaEI7QUFDRDs7O3FDQUVnQjtBQUFBLHdCQUNhLEtBQUtJLEtBRGxCO0FBQUEsVUFDUEwsUUFETyxlQUNQQSxRQURPO0FBQUEsVUFDR0MsS0FESCxlQUNHQSxLQURIO0FBR2YsV0FBS1EsVUFBTCxDQUFnQjtBQUFFVCxRQUFBQSxRQUFRLEVBQVJBLFFBQUY7QUFBWUMsUUFBQUEsS0FBSyxFQUFMQTtBQUFaLE9BQWhCO0FBQ0Q7OztzQ0FFK0I7QUFBQSxVQUFuQkQsUUFBbUIsU0FBbkJBLFFBQW1CO0FBQUEsVUFBVEMsS0FBUyxTQUFUQSxLQUFTO0FBQzlCLFdBQUtTLFFBQUwsQ0FBYztBQUFBLGVBQU1YLGlCQUFpQixDQUFDO0FBQUVDLFVBQUFBLFFBQVEsRUFBUkEsUUFBRjtBQUFZQyxVQUFBQSxLQUFLLEVBQUxBO0FBQVosU0FBRCxDQUF2QjtBQUFBLE9BQWQ7QUFDRDs7OzZCQUVRO0FBQUEsd0JBQ2lCLEtBQUtPLEtBRHRCO0FBQUEsVUFDQ04sSUFERCxlQUNDQSxJQUREO0FBQUEsVUFDT0MsS0FEUCxlQUNPQSxLQURQO0FBR1AsYUFDRSw2QkFBQyxjQUFELENBQU8sUUFBUCxRQUNHRCxJQURILEVBRUUsNkJBQUMsY0FBRDtBQUFPLFFBQUEsRUFBRSxFQUFFQyxLQUFYO0FBQWtCLFFBQUEsVUFBVSxFQUFFLEtBQUtHO0FBQW5DLFFBRkYsQ0FERjtBQU1EOzs7O0VBaENtQkssZUFBTUMsUzs7QUFtQzVCUixPQUFPLENBQUNTLFNBQVIsR0FBb0I7QUFDbEJiLEVBQUFBLFFBQVEsRUFBRWMsbUJBQVVDLE1BQVYsQ0FBaUJDLFVBRFQ7QUFFbEJmLEVBQUFBLEtBQUssRUFBRWEsbUJBQVVDLE1BQVYsQ0FBaUJDO0FBRk4sQ0FBcEI7O2VBS2UsK0JBQWlCO0FBQUEsTUFBR2hCLFFBQUgsU0FBR0EsUUFBSDtBQUFBLFNBQW1CO0FBQUVBLElBQUFBLFFBQVEsRUFBUkE7QUFBRixHQUFuQjtBQUFBLENBQWpCLEVBQW1ESSxPQUFuRCxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IGxvY2FsaXplIH0gZnJvbSAnLi4vTG9jYWxpemF0aW9uL0xvY2FsaXplJztcbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4uL2Nvbm5lY3RUb1dlYkNoYXQnO1xuaW1wb3J0IFRpbWVyIGZyb20gJy4vVGltZXInO1xuXG5jb25zdCBUSU1FUl9JTlRFUlZBTCA9IDYwMDAwO1xuXG5mdW5jdGlvbiBuZXh0VGltZXIoZGF0ZSkge1xuICBjb25zdCB0aW1lID0gbmV3IERhdGUoZGF0ZSkuZ2V0VGltZSgpO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gIHJldHVybiB0aW1lID4gbm93ID8gdGltZSA6IG5vdyArIFRJTUVSX0lOVEVSVkFMIC0gKChub3cgLSB0aW1lKSAlIFRJTUVSX0lOVEVSVkFMKTtcbn1cblxuZnVuY3Rpb24gZ2V0U3RhdGVGcm9tUHJvcHMoeyBsYW5ndWFnZSwgdmFsdWUgfSkge1xuICByZXR1cm4ge1xuICAgIHRleHQ6IGxvY2FsaXplKCdYIG1pbnV0ZXMgYWdvJywgbGFuZ3VhZ2UsIHZhbHVlKSxcbiAgICB0aW1lcjogbmV4dFRpbWVyKHZhbHVlKVxuICB9O1xufVxuXG5jbGFzcyBUaW1lQWdvIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmhhbmRsZUludGVydmFsID0gdGhpcy5oYW5kbGVJbnRlcnZhbC5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IGdldFN0YXRlRnJvbVByb3BzKHByb3BzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyBsYW5ndWFnZSwgdmFsdWUgfSkge1xuICAgIHRoaXMudXBkYXRlVGV4dCh7IGxhbmd1YWdlLCB2YWx1ZSB9KTtcbiAgfVxuXG4gIGhhbmRsZUludGVydmFsKCkge1xuICAgIGNvbnN0IHsgbGFuZ3VhZ2UsIHZhbHVlIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgdGhpcy51cGRhdGVUZXh0KHsgbGFuZ3VhZ2UsIHZhbHVlIH0pO1xuICB9XG5cbiAgdXBkYXRlVGV4dCh7IGxhbmd1YWdlLCB2YWx1ZSB9KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiBnZXRTdGF0ZUZyb21Qcm9wcyh7IGxhbmd1YWdlLCB2YWx1ZSB9KSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyB0ZXh0LCB0aW1lciB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIHJldHVybiAoXG4gICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgIHt0ZXh0fVxuICAgICAgICA8VGltZXIgYXQ9e3RpbWVyfSBvbkludGVydmFsPXt0aGlzLmhhbmRsZUludGVydmFsfSAvPlxuICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICApO1xuICB9XG59XG5cblRpbWVBZ28ucHJvcFR5cGVzID0ge1xuICBsYW5ndWFnZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICB2YWx1ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0VG9XZWJDaGF0KCh7IGxhbmd1YWdlIH0pID0+ICh7IGxhbmd1YWdlIH0pKShUaW1lQWdvKTtcbiJdfQ==